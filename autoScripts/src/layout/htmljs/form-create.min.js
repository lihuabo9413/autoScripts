/*!
 * FormCreate 低代码表单渲染器
 * @form-create/element-ui v2.7.3
 * (c) 2018-2025 xaboy
 * Github https://github.com/xaboy/form-create
 * Site https://form-create.com/
 * Released under the MIT License.
 */
(function(){"use strict";try{if(typeof document!="undefined"){var o=document.createElement("style");o.appendChild(document.createTextNode('._fc-frame .fc-files img{width:100%;height:100%;display:inline-block;vertical-align:top}._fc-frame .fc-upload-btn{border:1px dashed #c0ccda;cursor:pointer}._fc-frame .fc-upload-cover{opacity:0;position:absolute;inset:0;background:#0009;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}._fc-frame .fc-upload-cover i{color:#fff;font-size:20px;cursor:pointer;margin:0 2px}._fc-frame .fc-files:hover .fc-upload-cover{opacity:1}._fc-frame .el-upload{display:block}._fc-frame .fc-upload-btn,.fc-files{display:inline-block;width:58px;height:58px;text-align:center;line-height:58px;border:1px solid #c0ccda;border-radius:4px;overflow:hidden;background:#fff;position:relative;-webkit-box-shadow:2px 2px 5px rgba(0,0,0,.1);box-shadow:2px 2px 5px #0000001a;margin-right:4px;-webkit-box-sizing:border-box;box-sizing:border-box}._fc-upload .fc-files img{width:100%;height:100%;display:inline-block;vertical-align:top}._fc-upload .fc-upload-btn{border:1px dashed #c0ccda;cursor:pointer}._fc-upload .fc-upload-cover{opacity:0;position:absolute;inset:0;background:#0009;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}._fc-upload .fc-upload-cover i{color:#fff;font-size:20px;cursor:pointer;margin:0 2px}._fc-upload .fc-files:hover .fc-upload-cover{opacity:1}._fc-upload .fc-upload-btn,._fc-upload .fc-files{display:inline-block;width:58px;height:58px;text-align:center;line-height:58px;border:1px solid #c0ccda;border-radius:4px;overflow:hidden;background:#fff;position:relative;-webkit-box-shadow:2px 2px 5px rgba(0,0,0,.1);box-shadow:2px 2px 5px #0000001a;margin-right:4px;-webkit-box-sizing:border-box;box-sizing:border-box}._fc-group{display:flex;min-height:42px;justify-content:center;flex-direction:column}._fc-group-disabled ._fc-group-btn,._fc-group-disabled ._fc-group-add{cursor:not-allowed}._fc-group-handle{display:flex;flex-direction:row;position:absolute;bottom:-15px;right:30px;border-radius:15px;border:1px dashed #d9d9d9;padding:3px 8px;background-color:#fff}._fc-group-btn{cursor:pointer}._fc-group-idx{position:absolute;bottom:-15px;left:10px;width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:#eee;border-radius:15px;font-weight:700}._fc-group-handle ._fc-group-btn+._fc-group-btn{margin-left:7px}._fc-group-container{position:relative;display:flex;flex-direction:column;border:1px dashed #d9d9d9;padding:20px 20px 25px;margin:5px 5px 25px;border-radius:5px}._fc-group-arrow{position:relative;width:20px;height:20px}._fc-group-arrow:before{content:"";position:absolute;top:8px;left:5px;width:9px;height:9px;border-left:2px solid #999;border-top:2px solid #999}._fc-group-arrow:before{transform:rotate(45deg)}._fc-group-arrow._fc-group-down{transform:rotate(180deg)}._fc-group-plus-minus{width:20px;height:20px;position:relative;cursor:pointer}._fc-group-plus-minus:before,._fc-group-plus-minus:after{content:"";position:absolute;top:50%;left:50%;width:60%;height:2px;background-color:#409eff;transform:translate(-50%,-50%)}._fc-group-plus-minus:before{transform:translate(-50%,-50%) rotate(90deg)}._fc-group-plus-minus._fc-group-minus:before{display:none}._fc-group-plus-minus._fc-group-minus:after{background-color:#f56c6c}._fc-group-add{cursor:pointer;width:25px;height:25px;border:1px solid rgb(64 158 255 / 50%);border-radius:15px}._fc-group-add._fc-group-plus-minus:before,._fc-group-add._fc-group-plus-minus:after{width:50%}.form-create .form-create .el-form-item{margin-bottom:22px}.form-create{width:100%}.fc-form-row{box-sizing:border-box;display:flex;flex-wrap:wrap;position:relative}.form-create.is-preview .fc-clock,.form-create .fc-none,.form-create.is-preview .el-form-item.is-required>.el-form-item__label-wrap>.el-form-item__label:before,.form-create.is-preview .el-form-item.is-required>.el-form-item__label:before{display:none!important}.fc-wrap-right>.el-form-item__label{display:flex;justify-content:flex-end}.fc-wrap-left>.el-form-item__label{display:flex;justify-content:flex-start}.fc-wrap-top.el-form-item{display:block}.fc-wrap-top.el-form-item>.el-form-item__label{display:block;height:auto;line-height:22px;margin-bottom:8px;text-align:left}.fc-wrap-top.el-form-item>.el-form-item__content{margin-left:0!important}.el-form--large .fc-wrap-top.el-form-item>.el-form-item__label{line-height:22px;margin-bottom:12px}.el-form--default .fc-wrap-top.el-form-item>.el-form-item__label{line-height:22px;margin-bottom:8px}.el-form--small .fc-wrap-top.el-form-item>.el-form-item__label{line-height:20px;margin-bottom:4px}.fc-form-footer{margin-top:12px}')),document.head.appendChild(o)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
(function(P,m){typeof exports=="object"&&typeof module!="undefined"?m(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],m):(P=typeof globalThis!="undefined"?globalThis:P||self,m(P.formCreate={},P.Vue))})(this,function(P,m){"use strict";var Ei=Object.defineProperty,Fi=Object.defineProperties;var Si=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var Di=Object.prototype.hasOwnProperty,ji=Object.prototype.propertyIsEnumerable;var Nt=(P,m,N)=>m in P?Ei(P,m,{enumerable:!0,configurable:!0,writable:!0,value:N}):P[m]=N,_=(P,m)=>{for(var N in m||(m={}))Di.call(m,N)&&Nt(P,N,m[N]);if(Mt)for(var N of Mt(m))ji.call(m,N)&&Nt(P,N,m[N]);return P},G=(P,m)=>Fi(P,Si(m));function N(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Se(){return Se=Object.assign?Object.assign.bind():function(t){for(var e,r=1;r<arguments.length;r++)for(var i in e=arguments[r],e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Se.apply(this,arguments)}var qt=["attrs","props","domProps"],Ut=["class","style","directives"],Ht=["on","nativeOn"],Gt=function(t){return t.reduce(function(e,r){for(var i in r)if(!e[i])e[i]=r[i];else if(qt.indexOf(i)!==-1)e[i]=Se({},e[i],r[i]);else if(Ut.indexOf(i)!==-1){var s=e[i]instanceof Array?e[i]:[e[i]],n=r[i]instanceof Array?r[i]:[r[i]];e[i]=[].concat(s,n)}else if(Ht.indexOf(i)!==-1)for(var o in r[i])if(e[i][o]){var a=e[i][o]instanceof Array?e[i][o]:[e[i][o]],l=r[i][o]instanceof Array?r[i][o]:[r[i][o]];e[i][o]=[].concat(a,l)}else e[i][o]=r[i][o];else if(i==="hook")for(var u in r[i])e[i][u]=e[i][u]?Jt(e[i][u],r[i][u]):r[i][u];else e[i]=r[i];return e},{})},Jt=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}},Wt=Gt;const T=N(Wt);function De(t,e){return Object.keys(t).reduce((r,i)=>(r.push(t[i]),r),[])}const Kt={name:"fcCheckbox",props:{formCreateInject:{type:Object,required:!0},value:{type:Array,default:()=>[]},type:String},watch:{"formCreateInject.options":{handler(){this.update()},deep:!0},value(){this.update()}},data(){return{trueValue:[]}},methods:{options(){const t=this.formCreateInject.options;return Array.isArray(t)?t:[]},onInput(t){this.$emit("input",this.options().filter(e=>t.indexOf(e.label)!==-1).map(e=>e.value).filter(e=>e!==void 0))},update(){const t=Array.isArray(this.value)?this.value:[this.value];this.trueValue=this.options().filter(e=>t.indexOf(e.value)!==-1).map(e=>e.label)}},created(){this.update()},render(){const t=arguments[0];return t("ElCheckboxGroup",T([{},this.formCreateInject.prop,{},{props:{value:this.trueValue}},{ref:"el",on:{input:this.onInput}}]),[this.options().map((e,r)=>{const i=_({},e),s=this.type==="button"?"ElCheckboxButton":"ElCheckbox";return delete i.value,t(s,T([{},{props:i},{key:s+r+"-"+e.value}]))}),De(this.$slots)])},mounted(){this.$emit("fc.el",this.$refs.el)}};function q(t){return Array.isArray(t)?t:[null,void 0,""].indexOf(t)>-1?[]:[t]}const Xt={name:"fcFrame",props:{formCreateInject:{type:Object,required:!0},type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"el-icon-upload2"},width:{type:String,default:"500px"},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:""},closeBtnText:{type:String,default:""},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:{type:Function,default(t){this.previewImage=this.getSrc(t),this.previewVisible=!0}},modal:{type:Object,default:()=>({})},srcKey:{type:[String,Number]},value:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0}},data(){return{fileList:q(this.value),previewVisible:!1,frameVisible:!1,previewImage:""}},watch:{value(t){this.fileList=q(t)},fileList(t){const e=this.maxLength===1?t[0]||"":t;this.$emit("input",e),this.$emit("change",e)},src(t){this.modalVm&&(this.modalVm.src=t)}},methods:{key(t){return t},closeModel(t){this.$emit(t?"$close":"$ok"),this.reload&&(this.$off("$ok"),this.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModel(){this.disabled||this.onOpen()===!1||(this.frameVisible=!0)},makeInput(){const t=this.$createElement,e={type:"text",value:this.fileList.map(r=>this.getSrc(r)).toString(),readonly:!0};return t("ElInput",T([{},{props:e},{key:this.key("input")}]),[this.fileList.length?t("i",{slot:"suffix",class:"el-input__icon el-icon-circle-close",on:{click:()=>this.fileList=[]}}):null,t("ElButton",T([{attrs:{icon:this.icon}},{on:{click:()=>this.showModel()}},{slot:"append"}]))])},makeGroup(t){const e=this.$createElement;return(!this.maxLength||this.fileList.length<this.maxLength)&&t.push(this.makeBtn()),e("div",{key:this.key("group")},[...t])},makeItem(t,e){const r=this.$createElement;return r("div",{class:"fc-files",key:this.key("file"+t)},[...e])},valid(t){const e=this.formCreateInject.field||this.field;if(e&&t!==e)throw new Error("[frame]无效的字段值")},makeIcons(t,e){const r=this.$createElement;if(this.handleIcon!==!1||this.allowRemove===!0){const i=[];return(this.type!=="file"&&this.handleIcon!==!1||this.type==="file"&&this.handleIcon)&&i.push(this.makeHandleIcon(t,e)),this.allowRemove&&i.push(this.makeRemoveIcon(t,e)),r("div",{class:"fc-upload-cover",key:this.key("uc")},[i])}},makeHandleIcon(t,e){const r=this.$createElement;return r("i",{class:this.handleIcon===!0||this.handleIcon===void 0?"el-icon-view":this.handleIcon,on:{click:()=>this.handleClick(t)},key:this.key("hi"+e)})},makeRemoveIcon(t,e){const r=this.$createElement;return r("i",{class:"el-icon-delete",on:{click:()=>this.handleRemove(t)},key:this.key("ri"+e)})},makeFiles(){const t=this.$createElement;return this.makeGroup(this.fileList.map((e,r)=>this.makeItem(r,[t("i",{class:"el-icon-tickets",on:{click:()=>this.handleClick(e)}}),this.makeIcons(e,r)])))},makeImages(){const t=this.$createElement;return this.makeGroup(this.fileList.map((e,r)=>this.makeItem(r,[t("img",{attrs:{src:this.getSrc(e)}}),this.makeIcons(e,r)])))},makeBtn(){const t=this.$createElement;return t("div",{class:"fc-upload-btn",on:{click:()=>this.showModel()},key:this.key("btn")},[t("i",{class:this.icon})])},handleClick(t){return this.onHandle(t)},handleRemove(t){this.disabled||this.onBeforeRemove(t)!==!1&&(this.fileList.splice(this.fileList.indexOf(t),1),this.onRemove(t))},getSrc(t){return this.srcKey?t[this.srcKey]:t},frameLoad(t){this.onLoad(t);try{this.helper===!0&&(t.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModel()},set:(e,r)=>{this.valid(e),this.disabled||this.$emit("input",r)},get:e=>(this.valid(e),this.value),onOk:e=>this.$on("$ok",e),onClose:e=>this.$on("$close",e)})}catch(e){console.log(e)}},makeFooter(){const t=this.$createElement,{okBtnText:e,closeBtnText:r,closeBtn:i,okBtn:s,footer:n}=this.$props;if(n)return t("div",{slot:"footer"},[i?t("ElButton",{on:{click:()=>this.onCancel()!==!1&&(this.frameVisible=!1)}},[r||this.formCreateInject.t("close")||"关闭"]):null,s?t("ElButton",{attrs:{type:"primary"},on:{click:()=>this.onOk()!==!1&&this.closeModel()}},[e||this.formCreateInject.t("ok")||"确定"]):null])}},render(){const t=arguments[0],e=this.type;let r;e==="input"?r=this.makeInput():e==="image"?r=this.makeImages():r=this.makeFiles();const{width:i="30%",height:s,src:n,title:o,modalTitle:a}=this.$props;return this.$nextTick(()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})}),t("div",{class:"_fc-frame"},[r,t("el-dialog",T([{},{props:{appendToBody:!0,modal:this.previewMask,title:a,visible:this.previewVisible}},{on:{close:this.handleCancel}}]),[t("img",{style:"width: 100%",attrs:{src:this.previewImage}})]),t("el-dialog",T([{},{props:G(_({width:i,title:o,appendToBody:!0},this.modal),{visible:this.frameVisible})},{on:{close:()=>this.closeModel(!0)}}]),[this.frameVisible||!this.reload?t("iframe",{ref:"frame",attrs:{src:n,frameBorder:"0"},style:{height:s,border:"0 none",width:"100%"}}):null,this.makeFooter()])])},mounted(){this.$on("fc.closeModal",this.closeModal)}},zt={name:"fcRadio",props:{formCreateInject:{type:Object,required:!0},value:{},type:String},watch:{"formCreateInject.options":{handler(){this.update()},deep:!0},value(){this.update()}},data(){return{trueValue:[]}},methods:{options(){const t=this.formCreateInject.options;return Array.isArray(t)?t:[]},onInput(t){this.$emit("input",this.options().filter(e=>e.label===t).reduce((e,r)=>r.value,""))},update(){this.trueValue=this.options().filter(t=>t.value===this.value).reduce((t,e)=>e.label,"")}},created(){this.update()},render(){const t=arguments[0];return t("ElRadioGroup",T([{},this.formCreateInject.prop,{ref:"el"},{props:{value:this.trueValue}},{on:{input:this.onInput}}]),[this.options().map((e,r)=>{const i=_({},e),s=this.type==="button"?"ElRadioButton":"ElRadio";return delete i.value,t(s,T([{},{props:i},{key:s+r+"-"+e.value}]))}),De(this.$slots)])},mounted(){this.$emit("fc.el",this.$refs.el)}},h={type(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"},Undef(t){return t==null},Element(t){return typeof t=="object"&&t!==null&&t.nodeType===1&&!h.Object(t)},trueArray(t){return Array.isArray(t)&&t.length>0},Function(t){const e=this.getType(t);return e==="Function"||e==="AsyncFunction"},getType(t){const e=Object.prototype.toString.call(t);return/^\[object (.*)\]$/.exec(e)[1]},empty(t){return t==null||Array.isArray(t)&&Array.isArray(t)&&!t.length?!0:typeof t=="string"&&!t}};["Date","Object","String","Boolean","Array","Number"].forEach(t=>{h[t]=function(e){return h.type(e,t)}});function F(t,e){return{}.hasOwnProperty.call(t,e)}const Qt={name:"fcSelect",functional:!0,props:{formCreateInject:{type:Object,required:!0}},render(t,e){const r=(n,o)=>{const a=n.slot;return t("ElOption",T([{},{props:n},{key:""+o+"-"+n.value}]),[a?t("template",{slot:n.slotName||"default"},[h.Function(a)?n.slot(t):a]):null])},i=(n,o)=>t("ElOptionGroup",{attrs:{label:n.label},key:""+o+"-"+n.label},[h.trueArray(n.options)&&n.options.map((a,l)=>r(a,l))]),s=e.props.formCreateInject.options;return t("ElSelect",T([{},e.data,{ref:"el"}]),[(Array.isArray(s)?s:[]).map((n,o)=>F(n||"","options")?i(n,o):r(n,o)),e.children])},mounted(){this.$emit("fc.el",this.$refs.el)}},xt={name:"fcTree",formCreateParser:{mergeProp(t){const e=t.prop.props;e.nodeKey||(e.nodeKey="id"),e.props||(e.props={label:"title"})}},props:{formCreateInject:{type:Object,required:!0},type:{type:String,default:"checked"},value:{type:[Array,String,Number],default:()=>[]}},watch:{value(){this.setValue()}},methods:{onChange(){this.updateValue()},updateValue(){if(!this.$refs.tree)return;const t=this.type.toLocaleLowerCase();let e;t==="selected"?e=this.$refs.tree.getCurrentKey():e=this.$refs.tree.getCheckedKeys(),this.$emit("input",e)},setValue(){this.type.toLocaleLowerCase()==="selected"?this.$refs.tree.setCurrentKey(this.value):this.$refs.tree.setCheckedKeys(q(this.value))}},render(){const t=arguments[0];return t("ElTree",T([{},this.formCreateInject.prop,{ref:"tree",on:{check:()=>this.updateValue(),"node-click":()=>this.updateValue()}}]),[De(this.$slots)])},mounted(){this.setValue(),this.$emit("fc.el",this.$refs.tree)}};function et(t,e){return typeof t=="object"?t:{url:t,is_string:!0,name:Zt(t),uid:e}}function tt(t){return G(_({},t),{file:t,value:t})}function Zt(t){return(""+t).split("/").pop()}const Yt={name:"fcUpload",props:{formCreateInject:{type:Object,required:!0},onHandle:{type:Function,default(t){this.previewImage=t.url,this.previewVisible=!0}},uploadType:{type:String,default:"image"},limit:{type:Number,default:0},allowRemove:{type:Boolean,default:!0},previewMask:void 0,showFileList:Boolean,httpRequest:Function,modalTitle:String,listType:{type:String,default:"picture"},handleIcon:{type:[String,Boolean],default:()=>{}},value:[Array,String]},data(){return{uploadList:[],previewVisible:!1,previewImage:"",cacheFiles:[]}},created(){this.formCreateInject.prop.props.showFileList===void 0&&(this.formCreateInject.prop.props.showFileList=!1),this.formCreateInject.prop.props.fileList=q(this.value).map(et).map(tt)},watch:{value(t){this.$refs.upload.uploadFiles.every(e=>!e.status||e.status==="success")&&(this.$refs.upload.uploadFiles=q(t).map(et).map(tt),this.uploadList=this.$refs.upload.uploadFiles)},limit(t,e){(e===1||t===1)&&this.update()}},methods:{key(t){return t},isDisabled(){return this.formCreateInject.prop.props.disabled===!0},onRemove(t){this.isDisabled()||this.$refs.upload.handleRemove(t)},handleClick(t){this.onHandle(t)},makeItem(t,e){const r=this.$createElement;return this.uploadType==="image"?r("img",{attrs:{src:t.url},key:this.key("img"+e)}):r("i",{class:"el-icon-tickets",key:this.key("i"+e)})},makeRemoveIcon(t,e){const r=this.$createElement;return r("i",{class:"el-icon-delete",on:{click:()=>this.onRemove(t)},key:this.key("ri"+e)})},makeHandleIcon(t,e){const r=this.$createElement;return r("i",{class:this.handleIcon===!0||this.handleIcon===void 0?"el-icon-view":this.handleIcon,on:{click:()=>this.handleClick(t)},key:this.key("hi"+e)})},makeProgress(t,e){const r=this.$createElement;return r("ElProgress",T([{},{props:{percentage:t.percentage,type:"circle",width:52}},{style:"margin-top:2px;",key:this.key("pg"+e)}]))},makeIcons(t,e){const r=this.$createElement,i=[];if(this.allowRemove||this.handleIcon!==!1)return(this.uploadType!=="file"&&this.handleIcon!==!1||this.uploadType==="file"&&this.handleIcon)&&i.push(this.makeHandleIcon(t,e)),this.allowRemove&&i.push(this.makeRemoveIcon(t,e)),r("div",{class:"fc-upload-cover"},[i])},makeFiles(){const t=this.$createElement;if(this.listType==="picture")return this.uploadList.map((e,r)=>this.$scopedSlots.fileList?this.$scopedSlots.fileList({file:e,index:r,vm:this}):t("div",{key:this.key(r),class:"fc-files"},[e.percentage!==void 0&&e.status!=="success"?this.makeProgress(e,r):[this.makeItem(e,r),this.makeIcons(e,r)]]))},makeDefaultSlot(){const t=this.$createElement;return this.listType==="picture"?t("div",{class:"fc-upload-btn"},[t("i",{class:"el-icon-upload2"})]):this.listType==="text"?t("ElButton",{attrs:{type:"primary"}},[this.formCreateInject.t("clickToUpload")||"点击上传"]):t("i",{class:"el-icon-upload2"})},makeUpload(){const t=this.$createElement,e=!this.limit||this.limit>this.uploadList.length;return t("ElUpload",T([{},this.formCreateInject.prop,{},{props:{listType:this.listType,showFileList:this.listType!=="picture",httpRequest:this.doHttpRequest},style:{display:"inline-block"},key:this.key("upload"),ref:"upload"}]),[e?t("template",{slot:"default"},[this.$slots.default||this.makeDefaultSlot()]):null])},update(){let t=this.$refs.upload.uploadFiles.map(e=>e.is_string?e.url:e.value||e.url).filter(e=>e!==void 0);JSON.stringify(t)!==JSON.stringify(this.cacheFiles)&&(this.cacheFiles=[...t],this.$emit("input",this.limit===1?t[0]||"":t))},handleCancel(){this.previewVisible=!1},doHttpRequest(t){if(this.httpRequest)return this.httpRequest(t);t.source="upload",t.method="post",this.formCreateInject.api.fetch(t)}},render(){const t=arguments[0];return this.$refs.upload&&(this.formCreateInject.prop.props.fileList=this.$refs.upload.fileList),t("div",{class:"_fc-upload"},[[this.makeFiles(),this.makeUpload()],t("el-dialog",T([{},{props:{appendToBody:!0,modal:this.previewMask,title:this.modalTitle,visible:this.previewVisible}},{on:{close:this.handleCancel}}]),[t("img",{attrs:{alt:"example",src:this.previewImage},style:"width: 100%"})])])},mounted(){this.uploadList=this.$refs.upload.uploadFiles,this.$watch(()=>this.$refs.upload.uploadFiles,()=>{this.update()},{deep:!0}),this.$emit("fc.el",this.$refs.upload)}};function E(t,e,r){m.set(t,e,r)}function te(t,e){(m.del||m.delete)(t,e)}function pe(t,e={},r){let i=!1;for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)){let n=e[s];if((i=Array.isArray(n))||h.Object(n)){let o=t[s]===void 0;if(i)i=!1,o&&E(t,s,[]);else if(n._clone&&r!==void 0)if(r)n=n.getRule(),o&&E(t,s,{});else{E(t,s,n._clone());continue}else o&&E(t,s,{});t[s]=pe(t[s],n,r)}else E(t,s,n),h.Undef(n)||(h.Undef(n.__json)||(t[s].__json=n.__json),h.Undef(n.__origin)||(t[s].__origin=n.__origin))}return r!==void 0&&Array.isArray(t)?t.filter(s=>!s||!s.__ctrl):t}function W(t){return pe({},{value:t}).value}const er=Object.assign||function(t){for(let e,r=1;r<arguments.length;r++)for(let i in e=arguments[r],e)Object.prototype.hasOwnProperty.call(e,i)&&E(t,i,e[i]);return t};function C(){return er.apply(this,arguments)}function je(t){return typeof t!="object"||t===null?t:t instanceof Array?[...t]:_({},t)}const tr=[Kt,Xt,zt,Qt,xt,Yt,{name:"fcGroup",props:{field:String,rule:[Array,Object],rules:Array,expand:Number,options:Object,formCreateInject:{type:Object,required:!0},button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},value:{type:Array,default:()=>[]},sortBtn:{type:Boolean,default:!0},defaultValue:Object,disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},onBeforeRemove:{type:Function,default:()=>{}},onBeforeAdd:{type:Function,default:()=>{}},parse:Function},data(){return{len:0,cacheRule:{},cacheValue:{},sort:[],type:void 0}},computed:{formRule(){return this.rules?this.rules:this.rule?Array.isArray(this.rule)?this.rule:[this.rule]:[]}},watch:{cacheRule:{handler(t){this.sort=Object.keys(t)},immediate:!0},formRule:{handler(t,e){Object.keys(this.cacheRule).forEach(r=>{const i=this.cacheRule[r];if(i.$f){const s=i.$f.formData();if(t===e)i.$f.deferSyncValue(()=>{pe(i.rule,t),i.$f.setValue(s)},!0);else{const n=i.$f.formData();i.$f.once("reloading",()=>{i.$f.setValue(n)}),i.rule=W(t)}}})},deep:!0},expand(t){let e=t-this.value.length;e>0&&this.expandRule(e)},value(t,e){t=t||[];let r=this.sort,i=r.length,s=i-t.length;if(s<0){for(let n=s;n<0;n++)this.addRule(t.length+n);this.sort=Object.keys(this.cacheRule);for(let n=0;n<i;n++)this.setValue(r[n],t[n])}else{if(s>0){for(let n=0;n<s;n++)this.removeRule(r[i-n-1]);this.sort=Object.keys(this.cacheRule)}t.forEach((n,o)=>{this.setValue(r[o],t[o])})}}},methods:{_value(t){return t&&F(t,this.field)?t[this.field]:t},cache(t,e){this.cacheValue[t]=JSON.stringify(e)},input(t){this.$emit("input",t),this.$emit("change",t)},formData(t,e){const r=this.cacheRule,i=this.sort;if(i.filter(n=>r[n].$f).length!==i.length)return;const s=i.map(n=>{const o=t===n?e:_({},this.cacheRule[n].$f.form),a=this.field?o[this.field]||null:o;return this.cache(n,a),a});this.input(s)},setValue(t,e){const r=this.field,i=this.cacheRule[t].$f;r&&(e={[r]:this._value(e)}),this.cacheValue[t]!==JSON.stringify(r?e[r]:e)&&(this.cache(t,e),i&&i.coverValue(e||{}))},addRule(t,e){const r=this.formCreateInject.form.copyRules(this.formRule),i=this.options?_({},this.options):{submitBtn:!1,resetBtn:!1};if(this.defaultValue){i.formData||(i.formData={});const s=W(this.defaultValue);C(i.formData,this.field?{[this.field]:s}:s)}this.parse&&this.parse({rule:r,options:i,index:this.sort.length}),this.$set(this.cacheRule,++this.len,{rule:r,options:i}),e&&this.$nextTick(()=>this.$emit("add",r,Object.keys(this.cacheRule).length-1))},add$f(t,e,r){this.cacheRule[e].$f=r,this.$nextTick(()=>{this.$emit("itemMounted",r,Object.keys(this.cacheRule).indexOf(e))})},removeRule(t,e){const r=Object.keys(this.cacheRule).indexOf(t);this.$delete(this.cacheRule,t),this.$delete(this.cacheValue,t),e&&this.$nextTick(()=>this.$emit("remove",r))},add(t){this.disabled||this.onBeforeAdd(this.value)===!1||this.addRule(t,!0)},del(t,e){if(this.disabled||this.onBeforeRemove(this.value,t)===!1)return;this.removeRule(e,!0);const r=[...this.value];r.splice(t,1),this.input(r)},addIcon(t){const e=this.$createElement;return e("div",{class:"_fc-group-btn _fc-group-plus-minus",on:{click:this.add}})},delIcon(t,e){const r=this.$createElement;return r("div",{class:"_fc-group-btn _fc-group-plus-minus _fc-group-minus",on:{click:()=>this.del(t,e)}})},sortUpIcon(t){const e=this.$createElement;return e("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-up",on:{click:()=>this.changeSort(t,-1)}})},sortDownIcon(t){const e=this.$createElement;return e("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-down",on:{click:()=>this.changeSort(t,1)}})},changeSort(t,e){const r=this.sort[t];this.$set(this.sort,t,this.sort[t+e]),this.sort[t+e]=r,this.formData(0)},makeIcon(t,e,r){if(this.$scopedSlots.button)return this.$scopedSlots.button({total:t,index:e,vm:this,key:r,del:()=>this.del(e,r),add:this.add});const i=[];return(!this.max||t<this.max)&&t===e+1&&i.push(this.addIcon(r)),t>this.min&&i.push(this.delIcon(e,r)),this.sortBtn&&e&&i.push(this.sortUpIcon(e)),this.sortBtn&&e!==t-1&&i.push(this.sortDownIcon(e)),i},emitEvent(t,e,r,i){this.$emit(t,...e,this.cacheRule[i].$f,r)},expandRule(t){for(let e=0;e<t;e++)this.value.push(this.field?null:{})}},created(){this.type=this.formCreateInject.form.$form();const t=(this.expand||0)-this.value.length;t>0&&this.expandRule(t);for(let e=0;e<this.value.length;e++)this.addRule(e)},render(){const t=arguments[0],e=this.sort,r=this.button,i=this.type,s=this.disabled,n=e.length===0?this.$scopedSlots.default?this.$scopedSlots.default({vm:this,add:this.add}):t("div",{key:"a_def",class:"_fc-group-plus-minus _fc-group-add fc-clock",on:{click:this.add}}):e.map((o,a)=>{const{rule:l,options:u}=this.cacheRule[o],c=r&&!s?this.makeIcon(e.length,a,o):[];return t("div",{class:"_fc-group-container",key:o},[t(i,T([{key:o},{on:{"update:value":d=>this.formData(o,d),"emit-event":(d,...y)=>this.emitEvent(d,y,a,o),input:d=>this.add$f(a,o,d)}},{},{props:{disabled:s,inFor:!0,value:this.field?{[this.field]:this._value(this.value[a])}:this.value[a],rule:l,option:u,extendOption:!0}}])),t("div",{class:"_fc-group-idx"},[a+1]),c.length?t("div",{class:"_fc-group-handle fc-clock"},[c]):null])});return t("div",{key:"con",class:"_fc-group "+(s?"_fc-group-disabled":"")},[n])}},{name:"fcSubForm",props:{rule:Array,options:Object,formCreateInject:{type:Object,required:!0},value:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0}},data(){return{cacheRule:{},cacheValue:{},type:void 0}},watch:{value(t){this.setValue(t)}},methods:{formData(t){this.cacheValue=JSON.stringify(t),this.$emit("input",t),this.$emit("change",t)},setValue(t){const e=JSON.stringify(t);this.cacheValue!==e&&(this.cacheValue=e,this.cacheRule.$f.coverValue(t||{}))},addRule(){const t=this.options?this.options:{submitBtn:!1,resetBtn:!1};t.formData=_({},this.value||{}),this.cacheRule={rule:this.rule,options:t}},add$f(t){this.cacheRule.$f=t,this.$nextTick(()=>{this.$emit("itemMounted",t)})},emitEvent(t,...e){this.$emit(t,...e)}},created(){this.addRule(),this.type=this.formCreateInject.form.$form()},render(){const t=arguments[0],{rule:e,options:r}=this.cacheRule,i=this.type;return t(i,T([{},{on:{"update:value":this.formData,"emit-event":this.emitEvent,input:this.add$f}},{},{props:{rule:e,option:r,disabled:this.disabled,extendOption:!0}}]))}}];function se(t,e){var r=null;return function(...i){r!==null&&clearTimeout(r),r=setTimeout(()=>t.call(this,...i),e)}}function me(t){let e=t.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return e.indexOf("-")===0&&(e=e.substr(1)),e}const ye=(t,e)=>{if(!(!t||t===e||!t.$props)){if(t.$props.formCreateInject)return t.$props.formCreateInject;if(t.$parent)return ye(t.$parent,e)}};function rr(t,e,r){const i="FormCreate"+(t.isMobile?"Mobile":"");return{name:i,componentName:i,model:{prop:"api"},components:e,directives:r,provide(){return{$pfc:this}},inject:{$pfc:{default:null}},props:{rule:{type:Array,required:!0,default:()=>[]},option:{type:Object,default:()=>({})},extendOption:Boolean,driver:[String,Object],value:Object,disabled:{type:Boolean,default:void 0},preview:{type:Boolean,default:void 0},index:[String,Number],api:Object,locale:[String,Object],name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},render(){return this.fc.render()},setup(s){const n=m.getCurrentInstance().proxy;m.provide("parentFC",n);const o=m.inject("parentFC",null);let a=o;if(o)for(;a.parent;)a=a.parent;else a=n;const{rule:l,value:u,subForm:c,inFor:d}=m.toRefs(s),y=m.reactive({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:[...l.value||[]],updateValue:JSON.stringify(u.value||{})}),g=new t(n),b=g.api(),k=d.value,I=()=>{if(o){const R=ye(n,o);if(R){let j;k?(j=q(R.getSubForm()),j.push(b)):j=b,R.subForm(j)}}},ie=()=>{const R=ye(n,o);if(R)if(k){const j=q(R.getSubForm()),L=j.indexOf(b);L>-1&&j.splice(L,1)}else R.subForm()};let V=null;m.onBeforeMount(()=>{m.watch(()=>{let R="";const j=s.option&&s.option.globalClass||{};Object.keys(j).forEach(L=>{let le="";j[L].style&&Object.keys(j[L].style).forEach(Oe=>{le+=me(Oe)+":"+j[L].style[Oe]+";"}),j[L].content&&(le+=j[L].content+";"),le&&(R+=`.${L}{${le}}`)}),s.option&&s.option.style&&(R+=s.option.style),V||(V=document.createElement("style"),V.type="text/css",document.head.appendChild(V)),V.innerHTML=R||""},()=>{})});const H=se(()=>{g.bus.$emit("$loadData.$topForm")},100),Qe=se(()=>{g.bus.$emit("$loadData.$form")},100),ke=R=>{g.bus.$emit("change-$form."+R)};return m.onMounted(()=>{o&&(b.top.bus.$on("$loadData.$form",H),b.top.bus.$on("change",ke)),g.mounted()}),m.onBeforeUnmount(()=>{o&&(b.top.bus.$off("$loadData.$form",H),b.top.bus.$off("change",ke)),V&&document.head.removeChild(V),ie(),y.destroyed=!0,g.unmount()}),m.onUpdated(()=>{g.updated()}),m.watch(c,R=>{R?I():ie()},{immediate:!0}),m.watch(()=>[...l.value],R=>{g.$handle.isBreakWatch()||R.length===y.renderRule.length&&R.every(j=>y.renderRule.indexOf(j)>-1)||(g.$handle.updateAppendData(),g.$handle.reloadRule(l.value),n.renderRule())}),m.watch(()=>s.option,()=>{g.initOptions(),b.refresh()},{deep:!0}),m.watch(()=>[s.disabled,s.preview],()=>{b.refresh()}),m.watch(u,R=>{JSON.stringify(R||{})!==y.updateValue&&(b.config.forceCoverValue?b.coverValue(R||{}):b.setValue(R||{}))},{deep:!0,flush:"post"}),m.watch(()=>s.index,()=>{b.coverValue({}),g.$handle.updateAppendData(),m.nextTick(()=>{m.nextTick(()=>{b.clearValidateState()})})},{flush:"sync"}),G(_({fc:m.markRaw(g),parent:o&&m.markRaw(o),top:m.markRaw(a),fapi:m.markRaw(b)},m.toRefs(y)),{getGroupInject:()=>ye(n,o),refresh(){++y.unique},renderRule(){y.renderRule=[...l.value||[]]},updateValue(R){if(y.destroyed)return;const j=JSON.stringify(R);y.updateValue!==j&&(y.updateValue=j,n.$emit("update:value",R),m.nextTick(()=>{Qe(),o||H()}))}})},created(){this.$emit("input",this.fapi),this.fc.init()}}}const rt=["attrs","props","domProps","scopedSlots"],it=["class","style","directives"],nt=["on","nativeOn","hook"],Q=(t,e={},r={})=>{const i=[...rt,...r.normal||[]],s=[...it,...r.array||[]],n=[...nt,...r.functional||[]],o=r.props||[];return t.reduce((a,l)=>{for(const u in l)if(a[u])if(o.indexOf(u)>-1)a[u]=Q([l[u]],a[u]);else if(i.indexOf(u)>-1)a[u]=_(_({},a[u]),l[u]);else if(s.indexOf(u)>-1){const c=a[u]instanceof Array?a[u]:[a[u]],d=l[u]instanceof Array?l[u]:[l[u]];a[u]=[...c,...d]}else if(n.indexOf(u)>-1)for(const c in l[u])if(a[u][c]){const d=a[u][c]instanceof Array?a[u][c]:[a[u][c]],y=l[u][c]instanceof Array?l[u][c]:[l[u][c]];a[u][c]=[...d,...y]}else a[u][c]=l[u][c];else if(u==="hook")for(let c in l[u])a[u][c]?a[u][c]=ir(a[u][c],l[u][c]):a[u][c]=l[u][c];else a[u]=l[u];else i.indexOf(u)>-1||n.indexOf(u)>-1||o.indexOf(u)>-1?a[u]=_({},l[u]):s.indexOf(u)>-1?a[u]=l[u]instanceof Array?[...l[u]]:typeof l[u]=="object"?_({},l[u]):l[u]:a[u]=l[u];return a},e)},ir=(t,e)=>function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)},st=["type","slot","ignore","emitPrefix","value","name","native","hidden","display","inject","options","emit","nativeEmit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache"],Ae=["validate","children","control"],Ie=["effect","deep","renderSlots"];function ot(){return[...st,...rt,...it,...nt,...Ae,...Ie]}function at(t,e,r){return`[form-create ${t}]: ${e}`}function Pe(t,e){console.error(at("err",t))}function nr(t){Pe(t.toString()),console.error(t)}function lt(t){return t==null?"":typeof t=="object"?JSON.stringify(t,null,2):String(t)}const Te="[[FORM-CREATE-PREFIX-",Be="-FORM-CREATE-SUFFIX]]";function Ve(t,e){return JSON.stringify(pe(Array.isArray(t)?[]:{},t,!0),function(r,i){if(!(i&&i._isVue===!0)){if(typeof i!="function")return i;if(i.__json)return i.__json;if(i.__origin&&(i=i.__origin),!i.__emit)return Te+i+Be}},e)}function Le(t){return new Function("return "+t)()}function K(t,e){if(t&&h.String(t)&&t.length>4){let r=t.trim(),i=!1;try{if(r.indexOf(Be)>0&&r.indexOf(Te)===0)r=r.replace(Be,"").replace(Te,""),i=!0;else if(r.indexOf("$FN:")===0)r=r.substring(4),i=!0;else if(r.indexOf("$EXEC:")===0)r=r.substring(6),i=!0;else if(r.indexOf("$GLOBAL:")===0){const n=r.substring(8);return r=function(...o){const a=o[0].api.getGlobalEvent(n);if(a)return a.call(this,...o)},r.__json=t,r.__inject=!0,r}else{if(r.indexOf("$FNX:")===0)return r=Le("function($inject){"+r.substring(5)+"}"),r.__json=t,r.__inject=!0,r;(!e&&r.indexOf("function ")===0&&r!=="function "||!e&&r.indexOf("function(")===0&&r!=="function(")&&(i=!0)}if(!i)return t;let s;try{s=Le(r)}catch(n){s=Le("function "+r)}return s.__json=t,s}catch(s){Pe(`解析失败:${r}

err: ${s}`);return}}return t}function ut(t,e){return JSON.parse(t,function(r,i){return h.Undef(i)||!i.indexOf?i:K(i,e)})}let sr=0;function $e(){const t=370+ ++sr;return"F"+Math.random().toString(36).substr(3,3)+(+`${Date.now()}`).toString(36)+t.toString(36)+"c"}function re(t,e,r){let i=t,s;return(e||"").split(".").forEach(n=>{s&&((!i[s]||typeof i[s]!="object")&&E(i,s,{}),i=i[s]),s=n}),E(i,s,r),i}function Me(t,e){return{value:t,enumerable:!1,configurable:!1,writable:!!e}}function ct(t,e){return ft([t],e||!1)[0]}function ft(t,e){return pe([],[...t],e||!1)}function x(t,e){return Q(Array.isArray(e)?e:[e],t,{array:Ae,normal:Ie}),t}function ht(t){const e=h.Function(t.getRule)?t.getRule():t;return e.type||(e.type="input"),e}function or(t,e){return t?(Object.keys(e||{}).forEach(r=>{e[r]&&(t[r]=x(t[r]||{},e[r]))}),t):e}function dt(t,e){Object.defineProperties(t,Object.keys(e).reduce((r,i)=>(r[i]={get(){return e[i]()}},r),{}))}function Z(t){return t.__fc__||(t.__origin__?t.__origin__.__fc__:null)}function O(t,e){try{e=t()}catch(r){nr(r)}return e}function Ne(t,e){let r=null;return h.Function(t)?r=t():Array.isArray(t)?r=t.map(i=>Ne(i,e)):r=t,r&&e&&q(r).forEach(i=>{(Array.isArray(i)?i:[i]).forEach(n=>{n&&typeof n=="object"&&(n.data||(n.data={}),(!n.data.slot||n.data.slot==="default")&&(n.data.slot=e||"default"))})}),r}function ar(t,e){if(h.Object(t)){const r={};return Object.keys(t).forEach(i=>{r[i]=Ne(t[i],i)}),r}else return Ne(t,e)}function ve(){const t={},e=r=>r||"default";return{setSlot(r,i){r=e(r),!(!i||Array.isArray(i)&&i.length)&&(t[r]||(t[r]=[]),t[r].push(...Array.isArray(i)?i:[i]))},getSlot(r){r=e(r);const i=[];return(t[r]||[]).forEach(s=>{if(Array.isArray(s))i.push(...s);else if(h.Function(s)){const n=s();Array.isArray(n)?i.push(...n):i.push(n)}else h.Undef(s)||i.push(s)}),ar(i,r)},getSlots(){let r=[];return Object.keys(t).forEach(i=>{r=r.concat(this.getSlot(i)||[])}),r},slotLen(r){return r=e(r),t[r]?t[r].length:0},mergeBag(r){if(!r)return this;const i=h.Function(r.getSlots)?r.getSlots():r;return Array.isArray(r)||r.tag?this.setSlot(void 0,()=>r):Array.isArray(i)?this.setSlot(void 0,()=>i):Object.keys(i).forEach(s=>{this.setSlot(s,i[s])}),this}}}function be(t,e){return Object.setPrototypeOf(t,e),t}const pt=(t,e)=>typeof t=="string"?String(e):typeof t=="number"?Number(e):e,oe={"==":(t,e)=>JSON.stringify(t)===JSON.stringify(pt(t,e)),"!=":(t,e)=>!oe["=="](t,e),">":(t,e)=>t>e,">=":(t,e)=>t>=e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,on(t,e){return t&&t.indexOf&&t.indexOf(pt(t[0],e))>-1},notOn(t,e){return!oe.on(t,e)},in(t,e){return e&&e.indexOf&&e.indexOf(t)>-1},notIn(t,e){return!oe.in(t,e)},between(t,e){return t>e[0]&&t<e[1]},notBetween(t,e){return t<e[0]||t>e[1]},empty(t){return h.empty(t)},notEmpty(t){return!h.empty(t)},pattern(t,e){return new RegExp(e,"g").test(t)}};function M(t,e){return(Array.isArray(e)?e:(e||"").split(".")).forEach(r=>{t!=null&&(t=t[r])}),t}function lr(t){const e=/{{\s*(.*?)\s*}}/g;let r;const i={};for(;(r=e.exec(t))!==null;)r[1]&&(i[r[1]]=!0);return Object.keys(i)}function mt(t){let e=t.split("."),r=[],i="";return e.forEach((s,n)=>{n===0?i=s:i+="."+s,r.push(i)}),r.join(" && ")}function gt(){return{props:{},on:{},options:[],children:[],effect:{},hidden:!1,display:!0,value:void 0}}function B(t,e){return(r,i,s,n={})=>{const o=new qe(t,r,i,s,n);return e&&(h.Function(e)?e(o):o.props(e)),o}}function qe(t,e,r,i,s){this._data=C(gt(),{type:t,title:e,field:r,value:i,props:s||{}}),this.event=this.on}C(qe.prototype,{getRule(){return this._data},setProp(t,e){return E(this._data,t,e),this},_clone(){const t=new this.constructor;return t._data=ct(this._data),t}});function yt(t){t.forEach(e=>{qe.prototype[e]=function(r){return x(this._data,{[e]:arguments.length<2?r:{[r]:arguments[1]}}),this}})}yt(ot());const $t=B("");function ur(t,e,r){let i=$t("",e);return i._data.type=t,i._data.title=r,i}function vt(t,e,r,i){let s=$t("",r);return s._data.type="template",s._data.template=t,s._data.title=i,s._data.vm=e,s}function cr(){return{create:ur,createTmp:vt,template:vt,factory:B}}function fr(t,e,r){const i=`fail to ${t} ${r.status}'`,s=new Error(i);return s.status=r.status,s.url=t,s}function bt(t){const e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch(r){return e}}function _t(t){if(typeof XMLHttpRequest=="undefined")return;const e=new XMLHttpRequest;let r=t.action||"";if(e.upload&&t.onProgress&&e.upload.addEventListener("progress",n=>{n.percent=n.total>0?n.loaded/n.total*100:0,t.onProgress(n)}),t.query){const n=new URLSearchParams(t.query).toString();n&&(r.includes("?")?r+=`&${n}`:r+=`?${n}`)}e.onerror=function(o){t.onError(o)},e.onload=function(){if(e.status<200||e.status>=300)return t.onError(fr(r,t,e),bt(e));t.onSuccess(bt(e))},e.open(t.method||"get",r,!0);let i;(t.data||t.file)&&(t.file||(t.dataType||"").toLowerCase()!=="json"?(i=new FormData,Object.keys(t.data||{}).map(n=>{i.append(n,t.data[n])})):(i=JSON.stringify(t.data||{}),e.setRequestHeader("content-type","application/json"))),t.file&&i.append(t.filename,t.file,t.file.name),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);const s=t.headers||{};Object.keys(s).forEach(n=>{s[n]!=null&&e.setRequestHeader(n,s[n])}),e.send(i)}function Ct(t,e,r){return new Promise((i,s)=>{(e||_t)(G(_({},t),{onSuccess(n){let o=l=>l;const a=K(t.parse);h.Function(a)?o=a:a&&h.String(a)&&(o=l=>M(l,a)),i(o(n,void 0,r))},onError(n){s(n)}}))})}function ge(t){return W(t)}function hr(t){function e(n){return h.Undef(n)?n=t.fields():Array.isArray(n)||(n=[n]),n}function r(n,o,a){e(n).forEach(l=>{t.getCtxs(l).forEach(u=>{E(u.rule,o,a),t.$render.clearCache(u)})})}function i(){const n=t.subForm;return Object.keys(n).reduce((o,a)=>{const l=n[a];return l&&(Array.isArray(l)?o.push(...l):o.push(l)),o},[])}const s={get config(){return t.options},set config(n){t.fc.options.value=n},get options(){return t.options},set options(n){t.fc.options.value=n},get form(){return t.form},get rule(){return t.rules},get parent(){return t.vm.parent&&t.vm.parent.fapi},get top(){return s.parent?s.parent.top:s},get children(){return i()},get siblings(){const n=t.vm.getGroupInject();if(n){const o=n.getSubForm();if(Array.isArray(o))return[...o]}},get index(){const n=s.siblings;if(n){const o=n.indexOf(s);return o>-1?o:void 0}},formData(n){if(n==null){const o={};return Object.keys(t.form).forEach(a=>{t.ignoreFields.indexOf(a)===-1&&(o[a]=ge(t.form[a]))}),o}else return e(n).reduce((o,a)=>(o[a]=s.getValue(a),o),{})},getValue(n){const o=t.getFieldCtx(n);return o?ge(o.rule.value):t.options.appendValue!==!1&&F(t.appendData,n)?ge(t.appendData[n]):void 0},coverValue(n){const o=_({},n||{});t.deferSyncValue(()=>{t.appendData={},s.fields().forEach(a=>{const l=t.fieldCtx[a];if(l){const u=F(n,a);l.forEach(c=>{c.rule.value=u?n[a]:void 0}),delete o[a]}}),C(t.appendData,o)},!0)},setValue(n){let o=n;arguments.length>=2&&(o={[n]:arguments[1]}),t.deferSyncValue(()=>{Object.keys(o).forEach(a=>{const l=t.fieldCtx[a];if(!l)return t.appendData[a]=o[a];l.forEach(u=>{u.rule.value=o[a]})})},!0)},removeField(n){const o=t.getCtx(n);return t.deferSyncValue(()=>{t.getCtxs(n).forEach(a=>{a.rm()})},!0),o?o.origin:void 0},removeRule(n){const o=n&&Z(n);if(o)return o.rm(),o.origin},destroy:()=>{t.vm.$el.parentNode&&t.vm.$el.parentNode.removeChild(t.vm.$el),t.vm.$destroy()},fields:()=>t.fields(),append:(n,o,a)=>{let l=t.sort.length-1,u;const c=t.getCtx(o);if(c)if(a){if(u=c.getPending("children",c.rule.children),!Array.isArray(u))return;l=c.rule.children.length-1}else l=c.root.indexOf(c.origin),u=c.root;else u=t.rules;u.splice(l+1,0,n)},prepend:(n,o,a)=>{let l=0,u;const c=t.getCtx(o);if(c)if(a){if(u=c.getPending("children",c.rule.children),!Array.isArray(u))return}else l=c.root.indexOf(c.origin),u=c.root;else u=t.rules;u.splice(l,0,n)},hidden(n,o){r(o,"hidden",!!n),t.refresh()},hiddenStatus(n){const o=t.getCtx(n);if(o)return!!o.rule.hidden},display(n,o){r(o,"display",!!n),t.refresh()},displayStatus(n){const o=t.getCtx(n);if(o)return!!o.rule.display},disabled(n,o){e(o).forEach(a=>{t.getCtxs(a).forEach(l=>{E(l.rule.props,"disabled",!!n)})}),t.refresh()},all(n){return Object.keys(t.ctxs).map(o=>{const a=t.ctxs[o];return n?a.origin:a.rule})},model(n){return t.fields().reduce((o,a)=>{const l=t.fieldCtx[a][0];return o[a]=n?l.origin:l.rule,o},{})},component(n){return Object.keys(t.nameCtx).reduce((o,a)=>{const l=t.nameCtx[a].map(u=>n?u.origin:u.rule);return o[a]=l.length===1?l[0]:l,o},{})},bind(){return s.form},reload:n=>{t.reloadRule(n)},updateOptions(n){t.fc.updateOptions(n),s.refresh()},onSubmit(n){s.updateOptions({onSubmit:n})},sync:n=>{if(Array.isArray(n)){n.forEach(a=>s.sync(a));return}let o=h.Object(n)?Z(n):t.getCtxs(n);o&&(o=Array.isArray(o)?o:[o],o.forEach(a=>{if(!a.deleted){const l=t.subForm[a.id];l&&(Array.isArray(l)?l.forEach(u=>{u.refresh()}):l&&l.refresh()),t.$render.clearCache(a)}}),t.refresh())},refresh:()=>{i().forEach(n=>{n.refresh()}),t.$render.clearCacheAll(),t.refresh()},refreshOptions(){t.$manager.updateOptions(t.options),s.refresh()},hideForm:n=>{E(t.vm,"isShow",!n)},changeStatus:()=>t.changeStatus,clearChangeStatus:()=>{t.changeStatus=!1},updateRule(n,o){t.getCtxs(n).forEach(a=>{C(a.rule,o)})},updateRules(n){Object.keys(n).forEach(o=>{s.updateRule(o,n[o])})},mergeRule:(n,o)=>{t.getCtxs(n).forEach(a=>{x(a.rule,o)})},mergeRules(n){Object.keys(n).forEach(o=>{s.mergeRule(o,n[o])})},getRule:(n,o)=>{const a=t.getCtx(n);if(a)return o?a.origin:a.rule},getRenderRule:n=>{const o=t.getCtx(n);if(o)return o.prop},getRefRule:n=>{const o=t.getCtxs(n);if(o){const a=o.map(l=>l.rule);return a.length===1?a[0]:a}},setEffect(n,o,a){const l=t.getCtx(n);l&&o&&(o[0]==="$"&&(o=o.substr(1)),F(l.rule,"$"+o)&&E(l.rule,"$"+o,a),F(l.rule,"effect")||E(l.rule,"effect",{}),E(l.rule.effect,o,a))},clearEffectData(n,o){const a=t.getCtx(n);a&&(o&&o[0]==="$"&&(o=o.substr(1)),a.clearEffectData(o),s.sync(n))},updateValidate(n,o,a){a?s.mergeRule(n,{validate:o}):r(n,"validate",o)},updateValidates(n,o){Object.keys(n).forEach(a=>{s.updateValidate(a,n[a],o)})},refreshValidate(){s.refresh()},resetFields(n){e(n).forEach(o=>{t.getCtxs(o).forEach(a=>{t.$render.clearCache(a),a.rule.value=ge(a.defaultValue)})}),m.nextTick(()=>{m.nextTick(()=>{m.nextTick(()=>{s.clearValidateState(n)})})}),n==null&&(h.Function(t.options.onReset)&&O(()=>t.options.onReset(s)),t.vm.$emit("reset",s))},method(n,o){const a=s.el(n);if(!a||!a[o])throw new Error(at("err",`${o} 方法不存在`));return(...l)=>a[o](...l)},exec(n,o,...a){return O(()=>s.method(n,o)(...a))},toJson(n){return Ve(s.rule,n)},trigger(n,o,...a){const l=s.el(n);l&&l.$emit(o,...a)},el(n){const o=t.getCtx(n);if(o)return o.exportEl||o.el||t.vm.$refs[o.ref]},closeModal:n=>{const o=s.el(n);o&&o.$emit&&o.$emit("close-modal")},getSubForm(n){const o=t.getCtx(n);return o?t.subForm[o.id]:void 0},getChildrenRuleList(n){const o=typeof n=="object",a=o?Z(n):t.getCtx(n),l=a?a.rule:o?n:s.getRule(n);if(!l)return[];const u=[];return(d=>{d&&d.forEach(y=>{typeof y=="object"&&(y.field&&u.push(y),u.push(...s.getChildrenRuleList(y)))})})(a?a.loadChildrenPending():l.children),u},getParentRule(n){return(typeof n=="object"?Z(n):t.getCtx(n)).parent.rule},getParentSubRule(n){const a=typeof n=="object"?Z(n):t.getCtx(n);if(a){const l=a.getParentGroup();if(l)return l.rule}},getChildrenFormData(n){return s.getChildrenRuleList(n).reduce((a,l)=>(a[l.field]=ge(l.value),a),{})},setChildrenFormData(n,o,a){const l=s.getChildrenRuleList(n);t.deferSyncValue(()=>{l.forEach(u=>{F(o,u.field)?u.value=o[u.field]:a&&(u.value=void 0)})})},getGlobalEvent(n){let o=s.options.globalEvent[n];if(o)return typeof o=="object"&&(o=o.handle),K(o)},getGlobalData(n){return new Promise((o,a)=>{let l=s.options.globalData[n];l||o(t.fc.loadData[n]),l.type==="fetch"?s.fetch(l).then(u=>{o(u)}).catch(a):o(l.data)})},renderRule(n,o,a){const u=typeof n=="object"?Z(n):t.getCtx(n);return u?t.$render.createRuleVnode(u,o,a):void 0},renderChildren(n,o,a){const u=typeof n=="object"?Z(n):t.getCtx(n);return u?t.$render.createChildrenVnodes(u,o,a):void 0},nextTick(n){t.bus.$once("next-tick",n),t.refresh()},nextRefresh(n){t.nextRefresh(),n&&O(n)},emit(n,...o){t.vm.$emit(n,...o)},deferSyncValue(n,o){t.deferSyncValue(n,o)},bus:t.bus,fetch(n){return new Promise((o,a)=>{n=W(n),n=t.loadFetchVar(n),t.beforeFetch(n).then(()=>Ct(n,t.fc.create.fetch,s).then(l=>{O(()=>n.onSuccess&&n.onSuccess(l)),o(l)}).catch(l=>{O(()=>n.onError&&n.onError(l)),a(l)}))})},watchFetch(n,o,a,l){return t.fc.watchLoadData((u,c)=>{let d=W(n);d=t.loadFetchVar(d,u),!(l&&l(d,c)===!1)&&t.beforeFetch(d).then(()=>Ct(d,t.fc.create.fetch,s).then(y=>{O(()=>d.onSuccess&&d.onSuccess(y)),o&&o(y,c)}).catch(y=>{O(()=>d.onError&&d.onError(y)),a&&a(y)}))},n.wait==null?1e3:n.wait)},getData(n,o){return t.fc.getLoadData(n,o)},setData(n,o,a){return t.fc.setData(n,o,a)},refreshData(n){return t.fc.refreshData(n)},t(n,o){return t.fc.t(n,o)},getLocale(){return t.fc.getLocale()},helper:{tidyFields:e,props:r}};return["on","once","off","set","emit"].forEach(n=>{s[n]=function(...o){t.vm[`$${n}`](...o)}}),s.changeValue=s.changeField=s.setValue,s}function dr(t){C(t.prototype,{initCache(){this.clearCacheAll()},clearCache(e){if(!e.rule.cache){if(!this.cache[e.id]){e.parent&&this.clearCache(e.parent);return}(this.cache[e.id].use===!0||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id].parent&&this.clearCache(this.cache[e.id].parent),this.cache[e.id]=null}},clearCacheAll(){this.cache={}},setCache(e,r,i){this.cache[e.id]={vnode:r,use:!1,parent:i,slot:e.rule.slot}},getCache(e){const r=this.cache[e.id];if(r)return r.use=!0,r.vnode}})}function J(t){const e=t.replace(/(-[a-z])/g,function(r){return r.replace("-","").toLocaleUpperCase()});return wt(e)}function wt(t){return t.replace(t[0],t[0].toLowerCase())}function pr(t){C(t.prototype,{initRender(){this.cacheConfig={}},getTypeSlot(e){const r=i=>{if(i){let s;return e.rule.field&&(s=i.$scopedSlots["field-"+me(e.rule.field)]||i.$scopedSlots["field-"+e.rule.field]),s||(s=i.$scopedSlots["type-"+me(e.type)]||i.$scopedSlots["type-"+e.type]),s||r(i.$pfc)}};return r(this.vm)},render(){if(!this.vm.isShow)return;this.$manager.beforeRender();const e=ve();return this.sort.forEach(r=>{this.renderSlot(e,this.$handle.ctxs[r])}),this.$manager.render(e)},renderSlot(e,r,i){this.isFragment(r)?(r.initProp(),this.mergeGlobal(r),r.initNone(),this.renderChildren(r.loadChildrenPending(),r,r.rule.slot).forEach(n=>{e.setSlot(r.rule.slot,n)})):e.setSlot(r.rule.slot,this.renderCtx(r,i))},mergeGlobal(e){this.$handle.options.global&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=m.computed(()=>{const i=this.$handle.options.global;return x({},[i["*"]||i.default||{},i[e.originType]||i[e.type]||i[e.type]||{}])})),e.prop=x({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions(e){const r=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=r,e.prop.optionsTo&&r&&re(e.prop,e.prop.optionsTo,r)},deepSet(e){const r=e.rule.deep;r&&Object.keys(r).sort((i,s)=>i.length<s.length?-1:1).forEach(i=>{re(e.prop,i,r[i])})},parseSide(e,r){return h.Object(e)?x({props:{formCreateInject:r.prop.props.formCreateInject}},e):e},renderSides(e,r,i){const s=r[i?"rule":"prop"];return[this.renderRule(this.parseSide(s.prefix,r)),e,this.renderRule(this.parseSide(s.suffix,r))]},renderId(e,r){const i=this.$handle[r==="field"?"fieldCtx":"nameCtx"][e];return i?i.map(s=>this.renderCtx(s,s.parent)):void 0},renderCtx(e,r){try{if(e.type==="hidden")return;const i=e.rule;if(this.force||!this.cache[e.id]||this.cache[e.id].slot!==i.slot){let s;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);let n=e.prop;n.preview=!!(n.preview!=null?n.preview:this.$handle.preview),n.props.formCreateInject=this.injectProp(e);let o=n.cache!==!1;const a=n.preview;if(n.hidden){this.setCache(e,void 0,r);return}s=(...l)=>{const u={rule:i,prop:n,preview:a,api:this.$handle.api,model:n.model||{},slotValue:l};l.length&&i.slotUpdate&&O(()=>i.slotUpdate(u));let c=[];const d=e.loadChildrenPending();e.parser.renderChildren?c=e.parser.renderChildren(d,e):e.parser.loadChildren!==!1&&(c=this.renderChildren(d,e)),Object.keys(n.renderSlots||{}).forEach(b=>{c.push(this.renderRule({type:"template",slot:b},(()=>{if(h.Function(n.renderSlots[b]))return O(()=>n.renderSlots[b]());const k=this.parseSide(n.renderSlots[b],e);return this.renderRule(k)})()))});const y=this.getTypeSlot(e);let g;return y?(u.children=c,g=y(u)):g=a?e.parser.preview(je(c),e):e.parser.render(je(c),e),g=this.renderSides(g,e),!(!e.input&&h.Undef(n.native))&&n.native!==!0&&(this.fc.targetFormDriver("updateWrap",e),g=this.$manager.makeWrap(e,g)),e.none&&(Array.isArray(g)?g=g.map(b=>!b||!b.tag?b:this.none(b)):g=this.none(g)),o&&this.setCache(e,()=>this.stable(g),r),g},this.setCache(e,s,r)}return(...s)=>{const n=this.getCache(e);if(n)return n(...s);if(this.cache[e.id])return;const o=this.renderCtx(e,e.parent);if(o)return o()}}catch(i){console.error(i);return}},none(e){if(e)return e.data.class=this.mergeClass(e.data.class,"fc-none"),e},mergeClass(e,r){if(Array.isArray(e))e.push(r);else return e?[e,r]:r;return e},stable(e){return(Array.isArray(e)?e:[e]).forEach(i=>{i&&i.tag&&i.children&&typeof i.children=="object"&&(i.children.$stable=!0,this.stable(i.children))}),e},getModelField(e){return e.prop.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"value"},isFragment(e){return e.type==="fragment"||e.type==="template"},injectProp(e){const r=this.vm;r.ctxInject[e.id]||(r.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:s=>{this.$handle.addSubForm(e,s)},getSubForm:()=>this.$handle.subForm[e.id],slots:()=>this.vm.top.$scopedSlots,options:[],children:[],preview:!1,id:e.id,field:e.field,rule:e.rule,input:e.input,t:(...s)=>this.$handle.api.t(...s),updateValue:s=>{this.$handle.onUpdateValue(e,s)}});const i=r.ctxInject[e.id];return C(i,{preview:e.prop.preview,options:e.prop.options,prop:function(){const s=_({},e.prop);return s.on=s.on?_({},s.on):{},delete s.model,s}(),children:e.loadChildrenPending()}),i},ctxProp(e){const{ref:r,key:i,rule:s}=e;this.$manager.mergeProp(e),e.parser.mergeProp(e);const n=[{ref:r,key:s.key||`${i}fc`,slot:void 0,on:{"hook:mounted":()=>{this.onMounted(e)},"fc.updateValue":o=>{this.$handle.onUpdateValue(e,o)},"fc.el":o=>{e.exportEl=o,o&&((o.$el||o).__rule__=e.rule)}}}];if(e.input){const o=this.tmpInput;this.vm.$props.disabled===!0&&(e.prop.props.disabled=!0),e.prop.model={value:this.$handle.getFormData(e),callback:a=>{o&&o(e.field,a,e.rule),this.onInput(e,a)},expression:`formData.${e.id}`},e.prop.modelEmit&&n.push({on:{[e.prop.modelEmit]:()=>this.onEmitInput(e)}})}return Q(n,e.prop),e.prop},onMounted(e){e.el=this.vm.$refs[e.ref],e.el&&((e.el.$el||e.el).__rule__=e.rule),e.parser.mounted(e),this.$handle.effect(e,"mounted"),this.$handle.targetHook(e,"mounted")},onInput(e,r){if(e.prop.modelEmit){this.$handle.onBaseInput(e,r);return}this.$handle.onInput(e,r)},onEmitInput(e){this.$handle.setValue(e,e.parser.toValue(e.modelValue,e),e.modelValue)},renderChildren(e,r,i){if(!h.trueArray(e))return[];const s=ve();return e.map(n=>{if(n){if(h.String(n))return s.setSlot(null,i?this.renderRule({type:"template",children:[n]}):n);if(n.__fc__)return this.renderSlot(s,n.__fc__,r);n.type&&m.nextTick(()=>{this.$handle.loadChildren(e,r),this.$handle.refresh()})}}),s.getSlots()},defaultRender(e,r){const i=e.prop;return i.component?typeof i.component=="string"?this.vNode.make(i.component,i,r):this.vNode.makeComponent(i.component,i,r):this.vNode[e.type]?this.vNode[e.type](i,r):this.vNode[e.originType]?this.vNode[e.originType](i,r):this.vNode.make(wt(i.type),i,r)},createChildrenVnodes(e,r,i){this.force=i!==!1,this.tmpInput=r;const s=this.renderChildren(e.rule.children,e);return this.force=!1,this.tmpInput=null,s},createRuleVnode(e,r,i){this.force=i!==!1,this.tmpInput=r;const s=ve();return this.renderSlot(s,e,e.parent),this.force=!1,this.tmpInput=null,s.getSlots()},renderRule(e,r,i){if(!e)return;if(h.String(e))return e;let s;if(i)s=e.type;else if(s=e.is,e.type){s=J(e.type);const a=this.vNode.aliasMap[s];a&&(s=J(a))}if(!s)return;const n=ve();h.trueArray(e.children)&&e.children.forEach(a=>{a&&n.setSlot(a==null?void 0:a.slot,()=>this.renderRule(a))});const o=_({},e);return delete o.type,delete o.is,this.vNode.make(s,o,n.mergeBag(r).getSlots())}})}let mr=1;function Ue(t){C(this,{$handle:t,fc:t.fc,vm:t.vm,$manager:t.$manager,vNode:new t.fc.CreateNode(t.vm),force:!1,tmpInput:null,id:mr++}),dt(this,{options(){return t.options},sort(){return t.sort}}),this.initCache(),this.initRender()}dr(Ue),pr(Ue);function gr(t){C(t.prototype,{parseInjectEvent(e,r){const i=e.inject||this.options.injectEvent;return this.parseEventLst(e,r,i)},parseEventLst(e,r,i,s){return Object.keys(r).forEach(n=>{const o=this.parseEvent(e,r[n],i,s);o&&(r[n]=o)}),r},parseEvent(e,r,i,s){if(h.Function(r)&&(i!==!1&&!h.Undef(i)||r.__inject))return this.inject(e,r,i);if(!s&&Array.isArray(r)&&r[0]&&(h.String(r[0])||h.Function(r[0])))return this.parseEventLst(e,r,i,!0);if(h.String(r)){const n=K(r);if(n&&r!==n)return n.__inject?this.parseEvent(e,n,i,!0):n}},parseEmit(e,r){let i={},s=e.rule,{emitPrefix:n,field:o,name:a,inject:l}=s,u=s[r?"emit":"nativeEmit"]||[];return h.trueArray(u)&&u.forEach(c=>{if(!c)return;let d,y=n||o||a;if(h.Object(c)&&(d=c.inject,c=c.name,y=c.prefix||y),y){r||(y=`native-${y}`);const g=me(`${y}-${c}`),b=(...k)=>{this.vm.$emit(g,...k),this.vm.$emit("emit-event",g,...k),this.bus.$emit(g,...k)};if(b.__emit=!0,!d&&l===!1)i[c]=b;else{let k=d||l||this.options.injectEvent;i[c]=h.Undef(k)?b:this.inject(s,b,k)}}}),e.computed[r?"on":"nativeOn"]=i,i},getInjectData(e,r){const i=e.__fc__&&e.__fc__.$api,s=e.__fc__&&e.__fc__.$handle.vm||this.vm,{option:n,rule:o}=s.$props||s.$options.propsData;return{$f:i||this.api,api:i||this.api,rule:o,self:e.__origin__,option:n,inject:r}},inject(e,r,i){if(r.__origin){if(this.watching&&!this.loading)return r;r=r.__origin}const s=this,n=function(...o){const a=s.getInjectData(e,i);return a.args=[...o],o.unshift(a),r.apply(this,o)};return n.__origin=r,n.__json=r.__json,n},loadStrVar(e,r,i){if(e&&typeof e=="string"&&e.indexOf("{{")>-1&&e.indexOf("}}")>-1){const s=e,n=lr(e);let o;if(n.forEach(a=>{const l=a.split("||"),u=l[0].trim();if(u){const c=(l[1]||"").trim();let d,y=!1;if(i&&u.indexOf("$form.")===0){const g=u.split(".");g.shift(),F(i.value,g[0])&&(y=!0,d=r?r({id:"$form."+g[0]+"_"+i.rule.__fc__.id,getValue:()=>M(i.value,g)}):M(i.value,g))}y||(d=r?r(u,c):this.fc.getLoadData(u,c)),o=d,e=e.replaceAll(`{{${a}}}`,d==null?"":d)}}),n.length===1&&s===`{{${n[0]}}}`)return o}return e},loadFetchVar(e,r,i){let s;i&&i.__fc__&&(s=i.__fc__.getParentGroup());const n=o=>this.loadStrVar(o,r,s?{rule:i,value:this.subRuleData[s.id]||{}}:null);return e.action=n(e.action||""),["headers","data","query"].forEach(o=>{if(e[o]){const a={};Object.keys(e[o]).forEach(l=>{a[n(l)]=n(e[o][l])}),e[o]=a}}),e}})}const kt=["hook:updated","hook:mounted"];function yr(t){C(t.prototype,{usePage(){const e=this.options.page;if(!e)return;let r=25,i=$r(this.rules);h.Object(e)&&(e.first&&(r=parseInt(e.first,10)||r),e.limit&&(i=parseInt(e.limit,10)||i)),C(this,{first:r,limit:i,pageEnd:this.rules.length<=r}),this.bus.$on("page-end",()=>this.vm.$emit("page-end",this.api)),this.pageLoad()},pageLoad(){const e=()=>{this.pageEnd?(this.vm.$off(kt,e),this.bus.$emit("page-end")):(this.first+=this.limit,this.pageEnd=this.rules.length<=this.first,this.loadRule(),this.refresh())};this.vm.$on(kt,e)}})}function $r(t){return t.length<31?31:Math.ceil(t.length/3)}function vr(t){C(t.prototype,{clearNextTick(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick(e){this.clearNextTick(),this.nextTick=setTimeout(()=>{e(),this.nextTick=null},10)},render(){return++this.loadedId,this.vm.unique>0?this.$render.render():(this.vm.unique=1,[])}})}function br(t){Object.defineProperties(t.origin,{__fc__:Me(m.markRaw(t),!0)}),t.rule!==t.origin&&Object.defineProperties(t.rule,{__fc__:Me(m.markRaw(t),!0)})}function Ot(t,e,r){const i=$e(),s=!!e.field;C(this,{id:i,ref:i,wrapRef:i+"fi",rule:e,origin:e.__origin__||e,name:e.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],children:[],parent:null,group:e.subRule?this:null,cacheConfig:null,prop:_({},e),computed:{},payload:{},refRule:{},input:s,el:void 0,exportEl:void 0,defaultValue:s?W(r):void 0,field:e.field||void 0}),this.updateKey(),br(this),this.update(t,!0)}C(Ot.prototype,{getParentGroup(){let t=this.parent;for(;t;){if(t.group)return t;t=t.parent}},loadChildrenPending(){const t=this.rule.children||[];return Array.isArray(t)?t:this.loadPending({key:"children",origin:t,def:[],onLoad:e=>{this.$handle&&this.$handle.loadChildren(e,this)},onUpdate:(e,r)=>{this.$handle&&(e===r?this.$handle.loadChildren(e,this):this.$handle.updateChildren(this,e,r))},onReload:e=>{this.$handle?this.$handle.updateChildren(this,[],e):delete this.pending.children}})},loadPending(t){const{key:e,origin:r,def:i,onLoad:s,onReload:n,onUpdate:o}=t;if(this.pending[e]&&this.pending[e].origin===r)return this.getPending(e,i);delete this.pending[e];let a=r;if(h.Function(r)){let l=O(()=>r({rule:this.rule,api:this.$api,update:u=>{const c=u||i,d=this.getPending(e,i);this.setPending(e,r,c),o&&o(c,d)},reload:()=>{const u=this.getPending(e,i);delete this.pending[e],n&&n(u),this.$api&&this.$api.sync(this.rule)}}));l&&h.Function(l.then)?(l.then(u=>{const c=u||i;this.setPending(e,r,c),s&&s(c),this.$api&&this.$api.sync(this.rule)}).catch(u=>{console.error(u)}),a=i,this.setPending(e,r,a)):(a=l||i,this.setPending(e,r,a),s&&s(a))}return a},getPending(t,e){return this.pending[t]&&this.pending[t].value||e},setPending(t,e,r){this.pending[t]={origin:e,value:m.reactive(r)}},effectData(t){return this.payload[t]||(this.payload[t]={}),this.payload[t]},clearEffectData(t){t===void 0?this.payload={}:delete this.payload[t]},updateKey(t){this.key=$e(),t&&this.parent&&this.parent.updateKey(t)},updateType(){this.originType=this.rule.type,this.type=J(this.rule.type),this.trueType=this.$handle.getType(this.originType)},setParser(t){this.parser=t,t.init(this)},initProp(){var e,r;const t=_({},this.rule);delete t.children,delete t.validate,this.prop=x({},[t,...Object.keys(this.payload).map(i=>this.payload[i]),this.computed]),this.prop.validate=[...((r=(e=this.refRule)==null?void 0:e.__$validate)==null?void 0:r.value)||[],...this.prop.validate||[]]},initNone(){this.none=!(h.Undef(this.prop.display)||this.prop.display)},injectValidate(){return this.prop.validate},check(t){return this.vm===t.vm},unwatch(){this.watch.forEach(t=>t()),this.watch=[],this.refRule={}},unlink(){this.linkOn.forEach(t=>t()),this.linkOn=[]},link(){this.unlink(),this.$handle.appendLink(this)},watchTo(){this.$handle.watchCtx(this)},delete(){this.unwatch(),this.unlink(),this.rmCtrl(),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this)>>>0,1),C(this,{deleted:!0,computed:{},parent:null,children:[],cacheConfig:null,none:!1})},rmCtrl(){this.ctrlRule.forEach(t=>t.__fc__&&t.__fc__.rm()),this.ctrlRule=[]},rm(){const t=()=>{let e=this.root.indexOf(this.origin);e>-1&&(this.root.splice(e,1),this.$handle&&this.$handle.refresh())};if(this.deleted){t();return}this.$handle.noWatch(()=>{this.$handle.deferSyncValue(()=>{this.rmCtrl(),t(),this.$handle.rmCtx(this),C(this,{root:[]})},this.input)})},update(t,e){C(this,{deleted:!1,$handle:t,$render:t.$render,$api:t.api,vm:t.vm,vNode:t.$render.vNode,updated:!1,cacheValue:this.rule.value}),!e&&this.unwatch(),this.watchTo(),this.link(),this.updateType()}});function _r(t){C(t.prototype,{nextRefresh(e){const r=this.loadedId;m.nextTick(()=>{r===this.loadedId&&(e?e():this.refresh())})},parseRule(e){const r=ht(e);return Object.defineProperties(r,{__origin__:Me(e,!0)}),Cr(r),this.appendValue(r),[r,r.prefix,r.suffix].forEach(i=>{i&&this.loadFn(i,r)}),this.loadCtrl(r),r.update&&(r.update=K(r.update)),r},loadFn(e,r){["on","props","nativeOn","deep"].forEach(i=>{e[i]&&this.parseInjectEvent(r,e[i])})},loadCtrl(e){e.control&&e.control.forEach(r=>{r.handle&&(r.handle=K(r.handle))})},syncProp(e){const r=e.rule;h.trueArray(r.sync)&&Q([{on:r.sync.reduce((i,s)=>(i[typeof s=="object"&&s.event||`update:${s}`]=n=>{r.props[typeof s=="object"&&s.prop||s]=n,this.vm.$emit("sync",s,n,r,this.fapi)},i),{})}],e.computed)},loadRule(){this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue(()=>{if(this._loadRule(this.rules),this.loading=!1,this.cycleLoad&&this.pageEnd)return this.loadRule();this.syncForm(),this.pageEnd&&this.bus.$emit("load-end"),this.vm.renderRule()})},loadChildren(e,r){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,r),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(r)},_loadRule(e,r){const i=o=>{let a=e[o-1];if(!a||!a.__fc__)return o>0?i(o-1):-1;let l=this.sort.indexOf(a.__fc__.id);return l>-1?l:i(o-1)},s=(o,a)=>{h.trueArray(o)&&this._loadRule(o,a)},n=e.map((o,a)=>{if(r&&!h.Object(o)||!this.pageEnd&&!r&&a>=this.first)return;if(o.__fc__&&o.__fc__.root===e&&this.ctxs[o.__fc__.id])return s(o.__fc__.loadChildrenPending(),o.__fc__),o.__fc__;let l=ht(o);const u=()=>!!(l.field&&this.fieldCtx[l.field]&&this.fieldCtx[l.field][0]!==o.__fc__);this.fc.targetFormDriver("loadRule",{rule:l,api:this.api},this.fc),this.ruleEffect(l,"init",{repeat:u()}),u()&&this.vm.$emit("repeat-field",o,this.api);let c,d=!1,y=!!o.__fc__,g=l.value;if(y){if(c=o.__fc__,g=c.defaultValue,c.deleted){if(Rt(c))return;c.update(this)}else if(!c.check(this)){if(Rt(c))return;e[a]=o=o._clone?o._clone():ut(Ve(o)),c=null,d=!0}}if(c)c.originType!==c.rule.type&&c.updateType(),this.bindParser(c),this.appendValue(c.rule),c.parent&&c.parent!==r&&this.rmSubRuleData(c);else{const I=this.parseRule(o);c=new Ot(this,I,g),this.bindParser(c)}[!1,!0].forEach(I=>this.parseEmit(c,I)),this.syncProp(c),c.parent=r||null,c.root=e,this.setCtx(c),!d&&!y&&(this.effect(c,"load"),this.targetHook(c,"load")),this.effect(c,"created");const b=c.loadChildrenPending();if(c.parser.loadChildren===!1||s(b,c),!r){const I=i(a);I>-1||!a?this.sort.splice(I+1,0,c.id):this.sort.push(c.id)}const k=c.rule;return c.updated||(c.updated=!0,h.Function(k.update)&&this.bus.$once("load-end",()=>{this.refreshUpdate(c,k.value,"init")}),this.effect(c,"loaded")),this.refreshControl(c)&&(this.cycleLoad=!0),c}).filter(o=>!!o);r&&(r.children=n)},refreshControl(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl(e){const r=wr(e),i=[],s=this.api;if(!r.length)return!1;for(let a=0;a<r.length;a++){const l=r[a],u=l.handle||function(d){return(oe[l.condition||"=="]||oe["=="])(d,l.value)};if(!h.trueArray(l.rule))continue;const c=G(_({},l),{valid:O(()=>u(e.rule.value,s)),ctrl:kr(e,l.rule),isHidden:h.String(l.rule[0])});c.valid&&c.ctrl||!c.valid&&!c.ctrl&&!c.isHidden||i.push(c)}if(!i.length)return!1;const n=[];let o=!1;return this.deferSyncValue(()=>{i.reverse().forEach(({isHidden:a,valid:l,rule:u,prepend:c,append:d,child:y,ctrl:g,method:b})=>{if(a){l?e.ctrlRule.push({__ctrl:!0,children:u,valid:l}):g&&e.ctrlRule.splice(e.ctrlRule.indexOf(g)>>>0,1),n[l?"push":"unshift"](()=>{b==="disabled"||b==="enabled"?this.api.disabled(!l,u):b==="display"?this.api.display(l,u):b==="required"?(u.forEach(k=>{this.api.setEffect(k,"required",l)}),l||this.api.clearValidateState(u)):this.api.hidden(!l,u)});return}if(l){o=!0;const k={type:"fragment",native:!0,__ctrl:!0,children:u};e.ctrlRule.push(k),this.bus.$once("load-start",()=>{c?s.prepend(k,c,y):d||y?s.append(k,d||e.id,y):e.root.splice(e.root.indexOf(e.origin)+1,0,k)})}else{e.ctrlRule.splice(e.ctrlRule.indexOf(g),1);const k=Z(g);k&&k.rm()}})}),n.length&&(this.loading?n.length&&this.bus.$once("load-end",()=>{n.forEach(a=>a())}):n.length&&m.nextTick(()=>{n.forEach(a=>a())})),this.vm.$emit("control",e.origin,this.api),this.effect(e,"control"),o},reloadRule(e){return this._reloadRule(e)},_reloadRule(e){e||(e=this.rules);const r=_({},this.ctxs);this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue(()=>{this.bus.$once("load-end",()=>{Object.keys(r).filter(i=>this.ctxs[i]===void 0).forEach(i=>this.rmCtx(r[i])),this.$render.clearCacheAll()}),this.reloading=!0,this.loadRule(),this.reloading=!1,this.refresh(),this.vm.$emit("reloading",this.api)}),this.vm.$emit("update",this.api),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload)},refresh(){this.vm.refresh()}})}function Cr(t){const e=gt();return Object.keys(e).forEach(r=>{F(t,r)||E(t,r,e[r])}),t}function wr(t){const e=t.rule.control||[];return h.Object(e)?[e]:e}function kr(t,e){for(let r=0;r<t.ctrlRule.length;r++){const i=t.ctrlRule[r];if(i.children===e)return i}}function Rt(t){return!!t.rule.__ctrl}function Or(t){C(t.prototype,{setValue(e,r,i,s){e.deleted||(e.rule.value=r,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,i),this.syncValue(),this.valueChange(e,r),this.vm.$emit("change",e.field,r,e.origin,this.api,s||!1),this.effect(e,"value"),this.targetHook(e,"value",{value:r}),this.emitEvent("change",e.field,r,{rule:e.origin,api:this.api,setFlag:s||!1}),s&&m.nextTick(()=>{m.nextTick(()=>{m.nextTick(()=>{this.api.clearValidateState(e.id)})})}))},onInput(e,r){let i;e.input&&(this.isQuote(e,i=e.parser.toValue(r,e))||this.isChange(e,r))&&this.setValue(e,i,r)},onUpdateValue(e,r){this.deferSyncValue(()=>{const i=e.getParentGroup(),s=i?this.subRuleData[i.id]:null,n={};Object.keys(r||{}).forEach(o=>{s&&F(s,o)?n[o]=r[o]:F(this.api.form,o)?this.api.form[o]=r[o]:this.api.top!==this.api&&F(this.api.top.form,o)&&(this.api.top.form[o]=r[o])}),Object.keys(n).length&&this.api.setChildrenFormData(i.rule,n)})},onBaseInput(e,r){this.setFormData(e,r),e.modelValue=r,this.nextRefresh(),this.$render.clearCache(e)},setFormData(e,r){e.modelValue=r;const i=e.getParentGroup();i&&(this.subRuleData[i.id]||E(this.subRuleData,i.id,{}),E(this.subRuleData[i.id],e.field,e.rule.value)),E(this.formData,e.id,r)},rmSubRuleData(e){const r=e.getParentGroup();r&&this.subRuleData[r.id]&&te(this.subRuleData[r.id],e.field)},getFormData(e){return this.formData[e.id]},syncForm(){const e={},r=this.fields(),i=[];this.options.appendValue!==!1&&Object.keys(this.appendData).reduce((s,n)=>(r.indexOf(n)===-1&&(s[n]=m.toRef(this.appendData,n)),s),e),r.reduce((s,n)=>{const o=(this.fieldCtx[n]||[]).filter(a=>!this.isIgnore(a.rule))[0]||this.fieldCtx[n][0];return this.isIgnore(o.rule)&&i.push(n),s[n]=m.toRef(o.rule,"value"),s},e),this.form=m.reactive(e),this.ignoreFields=i,this.syncValue()},isIgnore(e){return e.ignore===!0||e.ignore==="hidden"&&e.hidden||this.options.ignoreHiddenFields&&e.hidden},appendValue(e){(!e.field||!F(this.appendData,e.field))&&!this.options.forceCoverValue||(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm(e,r){this.subForm[e.id]=r},deferSyncValue(e,r){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=r),O(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncForm())},syncValue(){if(this.deferSyncFn)return this.deferSyncFn.sync=!0;const e={};Object.keys(this.form).forEach(r=>{this.ignoreFields.indexOf(r)===-1&&(e[r]=this.form[r])}),this.vm.updateValue(e)},isChange(e,r){return JSON.stringify(this.getFormData(e),Et)!==JSON.stringify(r,Et)},isQuote(e,r){return(h.Object(r)||Array.isArray(r))&&r===e.rule.value},refreshUpdate(e,r,i,s){if(h.Function(e.rule.update)){const n=O(()=>e.rule.update(r,e.origin,this.api,{origin:i||"change",linkField:s}));if(n===void 0)return;e.rule.hidden=n===!0}},valueChange(e,r){this.refreshRule(e,r),this.bus.$emit("change-"+e.field,r)},refreshRule(e,r,i,s){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.vm.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,r,i,s)},appendLink(e){const r=e.rule.link;h.trueArray(r)&&r.forEach(i=>{const s=()=>this.refreshRule(e,e.rule.value,"link",i);this.bus.$on("change-"+i,s),e.linkOn.push(()=>this.bus.$off("change-"+i,s))})},fields(){return Object.keys(this.fieldCtx)}})}function Et(t,e){return typeof e=="function"?""+e:e}const _e={init(t){},toFormValue(t,e){return t},toValue(t,e){return t},mounted(t){},render(t,e){return e.$handle.fc.renderDriver&&e.$handle.fc.renderDriver.defaultRender?e.$handle.fc.renderDriver.defaultRender(e,t):e.$render.defaultRender(e,t)},preview(t,e){return e.$handle.fc.renderDriver&&e.$handle.fc.renderDriver.defaultPreview?e.$handle.fc.renderDriver.defaultPreview(e,t):this.render(t,e)},mergeProp(t){}},Rr=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"];function Er(t){C(t.prototype,{getCtx(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx(e,r,i){const s=`${i}Ctx`;this[s][r]?this[s][r].push(e):this[s][r]=[e]},rmIdCtx(e,r,i){const s=`${i}Ctx`,n=this[s][r];if(!n)return!1;const o=n.splice(n.indexOf(e)>>>0,1).length>0;return n.length||delete this[s][r],o},getFieldCtx(e){return(this.fieldCtx[e]||[])[0]},getNameCtx(e){return this.nameCtx[e]||[]},setCtx(e){let{id:r,field:i,name:s,rule:n}=e;this.ctxs[r]=e,s&&this.setIdCtx(e,s,"name"),e.input&&(this.setIdCtx(e,i,"field"),this.setFormData(e,e.parser.toFormValue(n.value,e)),this.isMounted&&!this.reloading&&this.vm.$emit("change",e.field,n.value,e.origin,this.api))},getParser(e){const r=this.fc.parsers,i=this.fc.renderDriver;if(i){const s=i.parsers||{},n=s[e.originType]||s[J(e.type)]||s[e.trueType];if(n)return n}return r[e.originType]||r[J(e.type)]||r[e.trueType]||_e},bindParser(e){e.setParser(this.getParser(e))},getType(e){const r=this.fc.CreateNode.aliasMap,i=r[e]||r[J(e)]||e;return J(i)},noWatch(e){this.noWatchFn||(this.noWatchFn=e),O(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx(e){if(ot().filter(i=>i[0]!=="_"&&i[0]!=="$"&&Rr.indexOf(i)===-1).forEach(i=>{const s=m.toRef(e.rule,i),n=i==="children";e.refRule[i]=s,e.watch.push(m.watch(n?()=>h.Function(s.value)?s.value:[...s.value||[]]:()=>s.value,(o,a)=>{let l=s.value;if(!this.isBreakWatch()){if(n&&e.parser.loadChildren===!1){this.$render.clearCache(e),this.nextRefresh();return}if(this.watching=!0,m.nextTick(()=>{this.targetHook(e,"watch",{key:i,oldValue:a,newValue:l})}),i==="hidden"&&!!l!=!!a&&(this.$render.clearCacheAll(),m.nextTick(()=>{this.targetHook(e,"hidden",{value:l})})),i==="ignore"&&e.input||i==="hidden"&&e.input&&(e.rule.ignore==="hidden"||this.options.ignoreHiddenFields))this.syncForm();else if(i==="link"){e.link();return}else["props","on","nativeOn","deep"].indexOf(i)>-1?(this.parseInjectEvent(e.rule,l||{}),i==="props"&&e.input&&this.setFormData(e,e.parser.toFormValue(e.rule.value,e))):["emit","nativeEmit"].indexOf(i)>-1?this.parseEmit(e,i==="emit"):["prefix","suffix"].indexOf(i)>-1?l&&this.loadFn(l,e.rule):i==="type"?(e.updateType(),this.bindParser(e)):n&&(h.Function(a)&&(a=e.getPending("children",[])),h.Function(l)&&(l=e.loadChildrenPending()),this.updateChildren(e,l,a));this.$render.clearCache(e),this.refresh(),this.watching=!1}},{deep:!n,sync:n}))}),e.refRule.__$title=m.computed(()=>{let i=(typeof e.rule.title=="object"?e.rule.title.title:e.rule.title)||"";if(i){const s=i.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);s&&(i=this.api.t(s[1]))}return i}),e.refRule.__$info=m.computed(()=>{let i=(typeof e.rule.info=="object"?e.rule.info.info:e.rule.info)||"";if(i){const s=i.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);s&&(i=this.api.t(s[1]))}return i}),e.refRule.__$validate=m.computed(()=>q(e.rule.validate).map(i=>{const s=_({},i);if(s.message){const n=s.message.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);n&&(s.message=this.api.t(n[1],{title:e.refRule.__$title.value}))}if(h.Function(s.validator)){const n=e;return s.validator=function(...o){return i.validator.call({that:this,id:n.id,field:n.field,rule:n.rule,api:n.$handle.api},...o)},s}return s})),e.input){const i=m.toRef(e.rule,"value");e.watch.push(m.watch(()=>i.value,()=>{let s=e.parser.toFormValue(i.value,e);this.isChange(e,s)&&this.setValue(e,i.value,s,!0)}))}this.bus.$once("load-end",()=>{let i=e.rule.computed;i&&(typeof i!="object"&&(i={value:i}),Object.keys(i).forEach(s=>{let n;const o=m.computed(()=>{const l=i[s];if(!l)return;const u=this.compute(e,l);return l.linkage&&u===void 0?n:u}),a=l=>{s==="value"?this.onInput(e,l):s[0]==="$"?this.api.setEffect(e.id,s,l):re(e.rule,s,l)};(s==="value"?[void 0,null,""].indexOf(e.rule.value)>-1:o.value!==M(e.rule,s))&&a(o.value),e.watch.push(m.watch(o,l=>{n=l,setTimeout(()=>{a(l)})}))}))}),this.watchEffect(e)},compute(e,r){let i;if(typeof r=="object"){const s=e.getParentGroup(),n=a=>{if(a=Array.isArray(a)?{mode:"AND",group:a}:a,!h.trueArray(a.group))return!0;const l=a.mode==="OR";let u=!0;for(let c=0;c<a.group.length;c++){const d=a.group[c];let y,g=null;if(d.variable)g=JSON.stringify(this.fc.getLoadData(d.variable)||"");else if(d.field)g=mt(d.field||"");else return!0;let b=d.compare;if(b&&(b=mt(b||"")),d.mode?y=n(d):oe[d.condition]?h.Function(d.handler)?y=O(()=>d.handler(this.api,e.rule)):y=O(()=>new Function("$condition","$val","$form","$group","$rule",`with($form){with(this){with($group){ return $condition['${d.condition}'](${g}, ${b||"$val"}); }}}`).call(this.api.form,oe,d.value,this.api.top.form,s?this.subRuleData[s.id]||{}:{},e.rule)):y=!1,l&&y)return!0;l||(u=u&&y)}return l?!1:u};let o=n(r);return o=r.invert===!0?!o:o,r.linkage?o?O(()=>this.computeValue(r.linkage,e,s),void 0):void 0:o}else if(h.Function(r))i=()=>r(this.api.form,this.api);else{const s=e.getParentGroup();i=()=>this.computeValue(r,e,s)}return O(i,void 0)},computeValue(e,r,i){const s=this,n=Object.keys(this.fc.formulas).reduce((o,a)=>(o[a]=function(...l){return s.fc.formulas[a].call({that:this,rule:r.rule,api:s.api,fc:s.fc},...l)},o),{});return new Function("$formulas","$form","$group","$rule","$api",`with($form){with(this){with($group){with($formulas){ return ${e} }}}}`).call(this.api.form,n,this.api.top.form,i?this.subRuleData[i.id]||{}:{},r.rule,this.api)},updateChildren(e,r,i){this.deferSyncValue(()=>{i&&i.forEach(s=>{(r||[]).indexOf(s)===-1&&s&&!h.String(s)&&s.__fc__&&s.__fc__.parent===e&&this.rmCtx(s.__fc__)}),h.trueArray(r)&&(this.loadChildren(r,e),this.bus.$emit("update",this.api))})},rmSub(e){h.trueArray(e)&&e.forEach(r=>{r&&r.__fc__&&this.rmCtx(r.__fc__)})},rmCtx(e){if(e.deleted)return;const{id:r,field:i,input:s,name:n}=e;te(this.ctxs,r),te(this.formData,r),te(this.subForm,r),te(this.vm.ctxInject,r);const o=e.getParentGroup();o&&this.subRuleData[o.id]&&te(this.subRuleData[o.id],i),e.group&&te(this.subRuleData,r),s&&this.rmIdCtx(e,i,"field"),n&&this.rmIdCtx(e,n,"name"),s&&!F(this.fieldCtx,i)&&te(this.form,i),this.deferSyncValue(()=>{if(!this.reloading){if(e.parser.loadChildren!==!1){const l=e.getPending("children",e.rule.children);h.trueArray(l)&&l.forEach(u=>u.__fc__&&this.rmCtx(u.__fc__))}e.root===this.rules&&this.vm.renderRule()}},s);const a=this.sort.indexOf(r);return a>-1&&this.sort.splice(a,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),this.targetHook(e,"deleted"),s&&!this.fieldCtx[i]&&this.vm.$emit("removeField",i,e.rule,this.api),e.rule.__ctrl||this.vm.$emit("removeRule",e.rule,this.api),e}})}function Fr(t){C(t.prototype,{mounted(){const e=()=>{this.isMounted=!0,this.lifecycle("mounted")};this.pageEnd?e():this.bus.$once("page-end",e)},lifecycle(e){this.fc.targetFormDriver(e,this.api,this.fc),this.vm.$emit(e,this.api),this.emitEvent(e,this.api)},emitEvent(e,...r){const i=this.options[e]||this.options[J("on-"+e)];if(i){const s=K(i);h.Function(s)&&O(()=>s(...r))}this.bus.$emit(e,...r)},targetHook(e,r,i){var n,o;let s=(o=(n=e.prop)==null?void 0:n.hook)==null?void 0:o[r];s&&(s=Array.isArray(s)?s:[s],s.forEach(a=>{O(()=>a(G(_({},i||{}),{rule:e.rule,api:this.api})))}))}})}function Sr(t){C(t.prototype,{useProvider(){const e=this.fc.providers;Object.keys(e).forEach(r=>{let i=e[r];h.Function(i)&&(i=i(this.fc)),i._c=jr(i),this.onEffect(i),this.providers[r]=i})},onEffect(e){const r=[];(e._c||["*"]).forEach(i=>{const s=i==="*"?"*":this.getType(i);r.indexOf(s)>-1||(r.push(s),this.bus.$on(`p:${e.name}:${s}:${e.input?1:0}`,(n,o)=>{e[n]&&e[n](...o)}))}),e._used=r},watchEffect(e){let r={required:()=>{var i,s;return(F(e.rule,"$required")?e.rule.$required:(s=(i=e.rule)==null?void 0:i.effect)==null?void 0:s.required)||!1}};Object.keys(e.rule.effect||{}).forEach(i=>{r[i]=()=>e.rule.effect[i]}),Object.keys(e.rule).forEach(i=>{i[0]==="$"&&(r[i.substr(1)]=()=>e.rule[i])}),Object.keys(r).forEach(i=>{e.watch.push(m.watch(r[i],s=>{this.effect(e,"watch",{[i]:s})},{deep:!0}))})},ruleEffect(e,r,i){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},r,i)},effect(e,r,i){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:i},r)},getEffect(e,r){if(F(e,"$"+r))return e["$"+r];if(F(e,"effect")&&F(e.effect,r))return e.effect[r]},emitEffect({ctx:e,rule:r,input:i,type:s,custom:n},o,a){if(!s||["fcFragment","fragment"].indexOf(s)>-1)return;const l=n||Object.keys(r).reduce((u,c)=>(c[0]==="$"&&(u[c.substr(1)]=r[c]),u),_({},r.effect||{}));Object.keys(l).forEach(u=>{const c=this.providers[u];if(!c||c.input&&!i)return;let d;if(!c._c)d="*";else if(c._used.indexOf(s)>-1)d=s;else return;const y=_({value:l[u],getValue:()=>this.getEffect(r,u)},a||{});e&&(y.getProp=()=>e.effectData(u),y.clearProp=()=>e.clearEffectData(u),y.mergeProp=g=>x(y.getProp(),[g]),y.id=e.id),this.bus.$emit(`p:${u}:${d}:${c.input?1:0}`,o,[y,r,this.api])})}})}function Dr(t){return t.filter(function(e,r,i){return i.indexOf(e,0)===r})}function jr(t){const e=t.components;if(Array.isArray(e)){const r=Dr(e.filter(i=>i!=="*"));return r.length?r:!1}else return h.String(e)?[e]:!1}function X(t){dt(this,{options(){return t.options.value||{}},bus(){return t.bus},preview(){return t.vm.$options.propsData.preview!=null?t.vm.$options.propsData.preview:t.options.value.preview||!1}}),C(this,{fc:t,vm:t.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:m.reactive({}),subRuleData:m.reactive({}),subForm:{},form:m.reactive({}),appendData:{},ignoreFields:[],providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:()=>{this.lifecycle("reload")}}),this.initData(t.rules),this.$manager=new t.manager(this),this.$render=new Ue(this),this.api=t.extendApiFn.reduce((e,r)=>{const i=O(()=>r(e,this));return i&&i!==e&&C(e,i),e},hr(this))}C(X.prototype,{initData(t){C(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:t})},init(){this.updateAppendData(),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.lifecycle("created")},updateAppendData(){this.appendData=_(_(_({},this.options.formData||{}),this.fc.vm.$options.propsData.value||{}),this.appendData)},isBreakWatch(){return this.loading||this.noWatchFn||this.reloading},beforeFetch(t){return new Promise(e=>{const r=this.options.beforeFetch&&O(()=>this.options.beforeFetch(t,{api:this.api}));r&&h.Function(r.then)?r.then(e):e()})}}),gr(X),yr(X),vr(X),_r(X),Or(X),Er(X),Fr(X),Sr(X);const He={name:"fcFragment",functional:!0,props:["vnode"],render(t,e){return e.props.vnode?e.props.vnode:e.children}};function Ar(t){return h.String(t)?{domProps:{innerHTML:t}}:t}function Ir(){const t={};function e(r){r&&this.setVm(r)}return C(e.prototype,{setVm(r){this.vm=r,this.h=this.$h=r.$createElement},make(r,i,s){var n,o;return(m.isReservedTag?m.isReservedTag(r):(n=m==null?void 0:m.config)!=null&&n.isReservedTag(r))&&(i==null||delete i.nativeOn,(o=i==null?void 0:i.props)==null||delete o.formCreateInject),this.makeComponent(r,i,s)},makeComponent(r,i,s){var o;let n=this.$h(r,Ar(i),s||[]);if((o=n==null?void 0:n.componentOptions)!=null&&o.propsData&&(i!=null&&i.props)){const a=Object.keys(n.componentOptions.propsData);n.data.attrs||(n.data.attrs={}),Object.keys(i.props).forEach(l=>{n.data.attrs[l]==null&&a.indexOf(l)===-1&&["string","number","boolean"].indexOf(typeof i.props[l])>-1&&(n.data.attrs[l]=i.props[l])})}return n.context=this.vm,n},aliasMap:t}),C(e,{aliasMap:t,alias(r,i){t[r]=i},use(r){Object.keys(r).forEach(i=>{const s=me(i),n=lt(i).toLocaleLowerCase(),o=r[i];[i,s,n].forEach(a=>{e.alias(i,o),e.prototype[a]=function(l,u){return this.make(o,l,u)}})})}}),e}function Pr(t){class e extends Ft{}return Object.assign(e.prototype,t),e}function Ft(t){C(this,{$handle:t,vm:t.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}C(Ft.prototype,{__init(){this.$render=this.$handle.$render,this.$r=(...t)=>this.$render.renderRule(...t)},updateKey(){this.key=$e()},init(){},update(){},beforeRender(){},form(){return this.vm.$refs[this.ref]},getSlot(t){const e=r=>{if(r){let i=r.$scopedSlots[t];return i||e(r.$pfc)}};return e(this.vm)},mergeOptions(t,e){return Q(t.map(r=>this.tidyOptions(r)),e,this.mergeOptionsRule)},updateOptions(t){this.$handle.fc.targetFormDriver("updateOptions",t,{handle:this.$handle,api:this.$handle.api}),this.options=this.mergeOptions([t],this.getDefaultOptions()),this.update()},tidyOptions(t){return t},tidyRule(t){},mergeProp(t){},getDefaultOptions(){return{}},render(t){}});const Tr=function(t){const e={name:"loadData",_fn:[],loaded(r,i,s){this.deleted(r);let n=q(r.getValue());const o=[];n.forEach(a=>{if(a&&(a.attr||a.template)){let l=d=>{let y;a.template?y=t.$handle.loadStrVar(a.template,d):a.handler&&h.Function(a.handler)?y=a.handler(d,i,s):y=d(a.attr,a.default),a.copy!==!1&&(y=W(y));const g=a.modify?i:r.getProp();a.to==="child"?g.children?E(g.children,0,y):E(g,"children",[y]):re(g,a.to||"options",y),s.sync(i)},u=d=>l(d);const c=t.watchLoadData(u);l=se(l,a.wait||300),a.watch!==!1?o.push(c):c()}}),this._fn[r.id]=o},deleted(r){this._fn[r.id]&&(this._fn[r.id].forEach(i=>{i()}),delete this._fn[r.id]),r.clearProp()}};return e.watch=e.mounted,e},Br=function(t){const e={name:"t",_fn:[],loaded(r,i,s){this.deleted(r);let n=r.getValue()||{};const o=[];Object.keys(n).forEach(a=>{const l=n[a];if(l){const u=typeof l=="object";let c=g=>{let b=t.t(u?l.attr:l,u?l.params:null,g);const k=u&&l.modify?i:r.getProp();a==="child"?k.children?E(k.children,0,b):E(k,"children",[b]):re(k,a,b),s.sync(i)},d=g=>c(g);const y=t.watchLoadData(d);c=se(c,l.wait||300),l.watch!==!1?o.push(y):y()}}),this._fn[r.id]=o},deleted(r){this._fn[r.id]&&(this._fn[r.id].forEach(i=>{i()}),delete this._fn[r.id]),r.clearProp()}};return e.watch=e.loaded,e},St={name:"componentValidate",load(t,e,r){let i=t.getValue();if(!i||i.method===!1)t.clearProp(),r.clearValidateState([e.field]);else{h.Object(i)||(i={method:i});const s=i.method;delete i.method,t.getProp().validate=[G(_({},i),{validator(...n){const o=Z(e);if(o)return r.exec(o.id,h.String(s)?s:"formCreateValidate",...n,{attr:t,rule:e,api:r})}})]}},watch(...t){St.load(...t)}},Vr={fetch:function(t){function e(s){return h.String(s)&&(s={action:s,to:"options"}),s}function r(s,n,o){let a=s.value;i.deleted(s),h.Function(a)&&(a=a(n,o)),a=e(a);const l=d=>{d===void 0?s.clearProp():re(s.getProp(),a.to||"options",d),o.sync(n)};if(!a||!a.action&&!a.key){l(void 0);return}if(a=W(a),a.to||(a.to="options"),a.key){const d=t.$handle.options.globalData[a.key];if(!d){l(void 0);return}if(d.type==="static"){l(d.data);return}else a=_(_({},a),d)}const u=a.onError,c=()=>{if(!s.getValue())return s.clearProp(),o.sync(n),!0};i._fn[s.id]=t.watchLoadData(se((d,y)=>{if(y&&a.watch===!1)return i._fn[s.id]();const g=t.$handle.loadFetchVar(W(a),d,n),b=G(_({headers:{}},g),{onSuccess(k,I){if(c())return;let ie=H=>I?H:F(H,"data")?H.data:H;const V=K(g.parse);h.Function(V)?ie=V:V&&h.String(V)&&(ie=H=>M(H,V)),l(ie(k,n,o)),o.sync(n)},onError(k){l(void 0),!c()&&(u||(I=>Pe(I.message||"fetch fail "+g.action)))(k,n,o)}});t.$handle.beforeFetch(b,{rule:n,api:o}).then(()=>{if(h.Function(g.action)){g.action(n,o).then(k=>{b.onSuccess(k,!0)}).catch(k=>{b.onError(k)});return}O(()=>t.create.fetch(b,{inject:s,rule:n,api:o}))})},a.wait||600))}const i={name:"fetch",_fn:[],loaded(...s){r(...s)},watch(...s){r(...s)},deleted(s){this._fn[s.id]&&(this._fn[s.id](),delete this._fn[s.id]),s.clearProp()}};return i},loadData:Tr,t:Br,componentValidate:St};function Lr(t){t=t||new Map;const e={$on(r,i){const s=t.get(r);s&&s.push(i)||t.set(r,[i])},$once(r,i){i._once=!0,e.$on(r,i)},$off(r,i){const s=t.get(r);s&&s.splice(s.indexOf(i)>>>0,1)},$emit(r,...i){(t.get(r)||[]).slice().map(s=>{s._once&&(e.$off(r,s),delete s._once),s(...i)}),(t.get("*")||[]).slice().map(s=>{s(r,i)})}};return e}const Mr={name:"html",loadChildren:!1,render(t,e){return e.prop.domProps||(e.prop.domProps={}),e.prop.domProps.innerHTML=t,e.vNode.make(e.prop.props.tag||"div",e.prop)},renderChildren(t){return Array.isArray(t)?t.filter(e=>h.String(e)).join(""):""}};function Nr(t){t=t+"=";const r=decodeURIComponent(document.cookie).split(";");for(let i=0;i<r.length;i++){let s=r[i];for(;s.charAt(0)===" ";)s=s.substring(1);if(s.indexOf(t)===0){s=s.substring(t.length,s.length);try{return JSON.parse(s)}catch(n){return s}}}return null}function qr(t){const e=localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(r){return e}return null}function Ur(t){const e=sessionStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(r){return e}return null}function Ge(t,e){if(!e)return null;const r=e.split(".");let i=t(r.shift());return r.length?i==null?null:M(i,r):i}function Hr(t){return Ge(Nr,t)}function Gr(t){return Ge(qr,t)}function Jr(t){return Ge(Ur,t)}function Wr(t,e){let r;return arguments.length===2?(r=arguments[1],e=r[t]):r=arguments[2],{id:e,prop:r}}function Je(){return Wr("name",...arguments)}function Kr(t){return!t||!t.el?window.document.body:h.Element(t.el)?t.el:document.querySelector(t.el)}function Xr(t,e){const r=new Vue({data(){return{rule:t,option:e||{}}},render(i){return i("FormCreate",{ref:"fc",props:this.$data})}});return r.$mount(),r}function zr(t){const e=t.key||[],r=t.array||[],i=t.normal||[];st.push(...e),Ae.push(...r),Ie.push(...i),yt([...e,...r,...i])}let Qr=1;const U={},Ce=Symbol("defValue");function Dt(t){const e={[He.name]:He},r={},i={},s={},n={},o=[],a=[],l=[t.extendApi],u=_({},Vr),c=cr();let d={global:{}};const y=t.isMobile===!0,g=m.reactive({$mobile:y}),b=Ir(),k={},I={};zr(t.attrs||{});function ie(f){const p=U[f];if(Array.isArray(p))return p.map($=>$.api());if(p)return p.api()}function V(f){o.push(f)}function H(){const f=Je(...arguments);f.id&&f.prop&&(i[f.id]=f.prop)}function Qe(){const f=Je(...arguments);f.id&&f.prop&&(u[f.id]=h.Function(f.prop)?f.prop:G(_({},f.prop),{name:f.id}))}function ke(f){b.use(f)}function R(){const f=Je(...arguments);if(!f.id||!f.prop)return _e;const p=J(f.id),$=f.prop,v=$.merge===!0?r[p]:void 0;r[p]=be($,v||_e),c[p]=B(p),$.maker&&C(c,$.maker)}function j(f,p){let $;if(h.String(f)){if($=f,p===void 0)return["form-create","formcreate"].indexOf($)>-1?L():e[$]}else $=J(f.name),p=f;if(!$||!p)return;const v=J($);e[$]=p,e[v]=p,delete b.aliasMap[$],delete b.aliasMap[v],delete r[$],delete r[v],p.formCreateParser&&R($,p.formCreateParser)}function L(){return rr(Ze,e,i)}function le(){return He}function Oe(f,p){return h.Function(f.install)?f.install(ue,p):h.Function(f)&&f(ue,p),this}function ue(f,p,$){let v=Xr(f,p||{});const w=v.$refs.fc.formCreate;return w.$parent=$,Kr(w.options).appendChild(v.$el),w.api()}be(ue,I);function $i(f){let p=_({},t);return f?p.inherit={components:e,parsers:r,directives:i,modelFields:s,providers:u,useApps:o,maker:c,formulas:k,loadData:g}:delete p.inherit,Dt(p)}function vi(f,p){s[f]=p}function bi(f,p){k[f]=p}function _i(f,p){const $=n[f]||{},v=$.parsers||{};p.parsers&&Object.keys(p.parsers).forEach(w=>{v[w]=be(p.parsers[w],_e)}),p.name=f,n[f]=G(_(_({},$),p),{parsers:v})}function Re(f){f&&Object.keys(U).forEach(p=>{(Array.isArray(U[p])?U[p]:[U[p]]).forEach(v=>{v.bus.$emit("$loadData."+f)})})}function xe(f,p){re(g,f,p),Re(f)}function Ee(f,p){const $=(...v)=>O(()=>p(...v));$._driver=!0,xe(f,$)}function Vt(f,p){const $=(f||"").split(".");f=$.shift();const v=$.join(".");if(F(g,f)||E(g,f,Ce),g[f]!==Ce){let w=g[f];return w&&w._driver?w=w(v):$.length&&(w=M(w,$)),w==null||w===""?p:w}else return p}function Ci(f){l.push(f)}function wi(f){delete g[f],Re(f)}function ki(f,p){a.push({name:f,callback:p})}function Ze(f){C(this,{id:Qr++,create:ue,vm:f,manager:Pr(t.manager),parsers:r,providers:u,modelFields:s,formulas:k,isMobile:y,rules:f.$options.propsData.rule,name:f.$options.propsData.name||$e(),inFor:f.$options.propsData.inFor,prop:{components:e,directives:i},drivers:n,renderDriver:null,refreshData:Re,loadData:g,CreateNode:b,bus:new Lr,unwatch:[],options:m.ref({}),extendApiFn:l,fetchCache:new WeakMap,tmpData:m.reactive({})}),a.forEach(p=>{this.bus.$on(p.name,p.callback)}),m.nextTick(()=>{m.watch(this.options,()=>{this.$handle.$manager.updateOptions(this.options.value),this.api().refresh()},{deep:!0})}),C(f.$options.components,e),C(f.$options.directives,i),this.$handle=new X(this),this.name&&(this.inFor?(U[this.name]||(U[this.name]=[]),U[this.name].push(this)):U[this.name]=this)}Ze.isMobile=y,C(Ze.prototype,{init(){this.isSub()&&this.unwatch.push(m.watch(()=>this.vm.parent.fc.options.value,()=>{this.initOptions(),this.$handle.api.refresh()},{deep:!0})),this.vm.$options.propsData.driver&&(this.renderDriver=typeof this.vm.$options.propsData.driver=="object"?this.vm.$options.propsData.driver:this.drivers[this.vm.$options.propsData.driver]),!this.renderDriver&&this.vm.parent&&(this.renderDriver=this.vm.parent.renderDriver),this.renderDriver||(this.renderDriver=this.drivers.default),this.initOptions(),this.$handle.init()},targetFormDriver(f,...p){if(this.renderDriver&&this.renderDriver[f])return O(()=>this.renderDriver[f](...p))},t(f,p,$){let v=$?$("$t."+f):this.globalLanguageDriver(f);return v==null&&(v=""),v&&p&&Object.keys(p).forEach(w=>{const D=new RegExp(`{${w}}`,"g");v=v.replace(D,p[w])}),v},globalDataDriver(f){let p=f.split(".");const $=p.shift(),v=this.options.value.globalData&&this.options.value.globalData[$];if(v){if(v.type==="static")return M(v.data,p);{let w;const D=this.fetchCache.get(v);if(D){if(D.status&&(w=M(D.data,p)),!D.loading)return w;D.loading=!1,this.fetchCache.set(v,D)}else this.fetchCache.set(v,{status:!1});const S=se(()=>{fe();const z=this.fetchCache.get(v);this.options.value.globalData&&Object.values(this.options.value.globalData).indexOf(v)!==-1?(z&&(z.loading=!0,this.fetchCache.set(v,z)),this.bus.$emit("$loadData.$globalData."+$)):this.fetchCache.delete(v)},v.wait||600),ce=z=>{this.fetchCache.set(v,{status:!0,data:z}),this.bus.$emit("$loadData.$globalData."+$)},ee=(z,he)=>{if(he&&v.watch===!1)return fe();if(he){S();return}const de=this.$handle.loadFetchVar(je(v),z);this.$handle.api.fetch(de).then(ne=>{ce(ne)}).catch(ne=>{ce(null)})},fe=this.watchLoadData(ee);return this.unwatch.push(fe),w}}},getLocale(){let f=this.vm.top.$props.locale;return f&&typeof f=="object"?f.name:typeof f=="string"?f:"zh-cn"},globalLanguageDriver(f){let p=this.vm.top.$props.locale,$;if(p&&typeof p=="object"&&($=M(p,f)),$==null){const v=this.options.value.language||{},w=this.getLocale();$=M(v[w],f)}return $},globalVarDriver(f){const $=f.split(".").shift(),v=this.options.value.globalVariable&&this.options.value.globalVariable[$];if(v){const w=h.Function(v)?v:K(v.handle);if(w){let D;const S=this.watchLoadData((ce,ee)=>{ee?(this.bus.$emit("$loadData.$var."+$),S()):D=w(ce,this.$handle.api)});return this.unwatch.push(S),D}}},setData(f,p,$){$?xe(f,p):(re(this.vm.top.fc.tmpData,f,p),this.bus.$emit("$loadData."+f))},getLoadData(f,p){let $=null;if(f!=null){let v=f.split(".");const w=v.shift();if(w==="$topForm")$=this.$handle.api.top.formData();else if(w==="$form")$=this.$handle.api.formData();else if(w==="$options")$=this.options.value;else if(w==="$globalData")$=this.globalDataDriver(v.join(".")),v=[];else if(w==="$var")$=this.globalVarDriver(v.join(".")),v=[];else if(w==="$locale")$=this.getLocale(),v=[];else if(w==="$t")$=this.globalLanguageDriver(v.join(".")),v=[];else{if(w==="$preview")return this.$handle.preview;{const D=this.vm.top.fc.tmpData;F(D,w)||E(D,w,Ce),$=D[w]!==Ce?M(D,f):Vt(f),v=[]}}$&&v.length&&($=M($,v))}return $==null||$===""?p:$},watchLoadData(f,p){let $={};const v=S=>{O(()=>{f(w,S)})},w=(S,ce)=>{let ee;if(typeof S=="object"&&(ee=S.getValue,S=S.id),$[S])return $[S].val;const fe=m.computed(()=>ee?ee():this.getLoadData(S,ce)),z=S.split("."),he=z.shift(),de=z.shift()||"",ne=se(()=>{const Ye=ee?ee():this.getLoadData(S,ce);if($[S])JSON.stringify(Ye)!==JSON.stringify($[S].val)&&($[S].val=Ye,v(!0));else return},p||0),Ri=m.watch(fe,Ye=>{ne()});return this.bus.$on("$loadData."+he,ne),de&&this.bus.$on("$loadData."+he+"."+de,ne),$[S]={fn:()=>{this.bus.$off("$loadData."+he,ne),de&&this.bus.$off("$loadData."+he+"."+de,ne),Ri()},val:fe.value},fe.value};v(!1);const D=()=>{Object.keys($).forEach(S=>$[S].fn()),$={}};return this.unwatch.push(D),D},isSub(){return this.vm.parent&&this.vm.extendOption},initOptions(){this.options.value={};let f=_({formData:{},submitBtn:{},resetBtn:{},globalEvent:{},globalData:{}},W(d));this.isSub()&&(f=this.mergeOptions(f,this.vm.parent.fc.options.value||{},!0)),f=this.mergeOptions(f,this.vm.$options.propsData.option||{}),this.updateOptions(f)},mergeOptions(f,p,$){return p=_({},p||{}),$&&["page","onSubmit","onReset","onCreated","onChange","onMounted","mounted","onReload","reload","formData","el","globalClass","style"].forEach(v=>{delete p[v]}),p.global&&(f.global=or(f.global,p.global),delete p.global),this.$handle.$manager.mergeOptions([p],f),f},updateOptions(f){this.options.value=this.mergeOptions(this.options.value,f),this.$handle.$manager.updateOptions(this.options.value),this.bus.$emit("$loadData.$options")},api(){return this.$handle.api},render(){return this.$handle.render()},mounted(){this.$handle.mounted()},unmount(){if(this.name)if(this.inFor){const f=U[this.name].indexOf(this);U[this.name].splice(f,1)}else delete U[this.name];a.forEach(f=>{this.bus.$off(f.name,f.callback)}),this.tmpData={},this.unwatch.forEach(f=>f()),this.unwatch=[],this.$handle.reloadRule([])},updated(){this.$handle.bindNextTick(()=>this.bus.$emit("next-tick",this.$handle.api))}});function Lt(f){C(f,{version:t.version,ui:t.ui,isMobile:y,extendApi:Ci,getData:Vt,setDataDriver:Ee,setData:xe,removeData:wi,refreshData:Re,maker:c,component:j,directive:H,setModelField:vi,setFormula:bi,setDriver:_i,register:Qe,$vnode:le,parser:R,use:Oe,factory:$i,componentAlias:ke,copyRule:ct,copyRules:ft,mergeRule:x,fetch:_t,$form:L,parseFn:K,parseJson:ut,toJson:Ve,useApp:V,getApi:ie,on:ki})}function Oi(f){C(f,{create:ue,install(p,$){if(d=_(_({},d),$||{}),p._installedFormCreate===!0)return;p._installedFormCreate=!0;const v=function(D,S={}){return ue(D,S,this)};Lt(v),p.prototype.$formCreate=v;const w=L();p.component(w.name,w),p.component("FcFragment",le()),o.forEach(D=>{O(()=>D(f,p))})}})}if(Lt(I),Oi(I),Ee("$cookie",Hr),Ee("$localStorage",Gr),Ee("$sessionStorage",Jr),b.use({fragment:"fcFragment"}),t.install&&ue.use(t),R(Mr),t.inherit){const f=t.inherit;f.components&&C(e,f.components),f.parsers&&C(r,f.parsers),f.directives&&C(i,f.directives),f.modelFields&&C(s,f.modelFields),f.providers&&C(u,f.providers),f.useApps&&C(o,f.useApps),f.maker&&C(c,f.maker),f.loadData&&C(g,f.loadData),f.formulas&&C(k,f.formulas)}const Fe=L();return be(Fe,I),Object.defineProperties(Fe,{fetch:{get(){return I.fetch},set(f){I.fetch=f}}}),Fe.util=I,Fe}const jt={date:"yyyy-MM-dd",month:"yyyy-MM",datetime:"yyyy-MM-dd HH:mm:ss",timerange:"HH:mm:ss",daterange:"yyyy-MM-dd",monthrange:"yyyy-MM",datetimerange:"yyyy-MM-dd HH:mm:ss",year:"yyyy"},At="datePicker",xr={name:At,maker:function(){return["year","month","date","dates","week","datetime","datetimeRange","dateRange","monthRange"].reduce((t,e)=>(t[e]=B(At,{type:e.toLowerCase()}),t),{})}(),mergeProp(t){const e=t.prop.props;e.valueFormat||(e.valueFormat=jt[e.type]||jt.date)}},We="hidden",Zr={name:We,maker:{[We]:(t,e)=>B(We)("",t,e)},render(){return[]}},Ke="input",Yr={name:Ke,maker:function(){const t=["password","url","email","text","textarea"].reduce((e,r)=>(e[r]=B(Ke,{type:r}),e),{});return t.idate=B(Ke,{type:"date"}),t}(),mergeProp(t){let{props:e}=t.prop;e&&e.autosize&&e.autosize.minRows&&(e.rows=e.autosize.minRows||2)}},It="slider",ei={name:It,maker:{sliderRange:B(It,{range:!0})},toFormValue(t,e){let r=Array.isArray(t),i=e.prop.props,s=i.min||0,n;return i.range===!0?n=r?t:[s,parseFloat(t)||s]:n=r?parseFloat(t[0])||s:parseFloat(t),n}},Xe="timePicker",ti={name:Xe,maker:{time:B(Xe,t=>t.props.isRange=!1),timeRange:B(Xe,t=>t.props.isRange=!0)},mergeProp(t){const e=t.prop.props;e.valueFormat||(e.valueFormat="HH:mm:ss")}},ri=[xr,Zr,Yr,ei,ti,{name:"FcRow",render(t,e){return e.vNode.col({props:{span:24}},[e.vNode.row(e.prop,t)])}},{name:"select",toFormValue(t,e){return e.prop.props.multiple&&!Array.isArray(t)?q(t):t}}],A="el",ii={button:A+"Button",icon:"i",slider:A+"Slider",rate:A+"Rate",upload:"fcUpload",cascader:A+"Cascader",popover:A+"Popover",tooltip:A+"Tooltip",colorPicker:A+"ColorPicker",timePicker:A+"TimePicker",timeSelect:A+"TimeSelect",datePicker:A+"DatePicker",switch:A+"Switch",select:"fcSelect",checkbox:"fcCheckbox",radio:"fcRadio",inputNumber:A+"InputNumber",number:A+"InputNumber",input:A+"Input",formItem:A+"FormItem",form:A+"Form",frame:"fcFrame",col:A+"Col",row:A+"Row",tree:"fcTree",autoComplete:A+"Autocomplete",auto:A+"Autocomplete",group:"fcGroup",array:"fcGroup",object:"fcSubForm",subForm:"fcSubForm"};function ni(){return{form:{inline:!1,labelPosition:"right",labelWidth:"125px",disabled:!1,size:void 0},row:{show:!0,gutter:0},submitBtn:{type:"primary",loading:!1,disabled:!1,innerText:"",show:!0,col:void 0,click:void 0},resetBtn:{type:"default",loading:!1,disabled:!1,icon:"el-icon-refresh",innerText:"",show:!1,col:void 0,click:void 0}}}function si(t){return t.type==="tooltip"}function Pt(t,e){F(t,e)&&h.String(t[e])&&(t[e]={[e]:t[e],show:!0})}function Y(t){return t===!1}function oi(t,e){F(t,e)&&!h.Object(t[e])&&(t[e]={show:!!t[e]})}function ze(t){const e=_({},t);return delete e.children,e}const ai={validate(){const t=this.form();return t?t.validate():new Promise(e=>e())},validateField(t){return new Promise((e,r)=>{const i=this.form();i?i.validateField(t,(s,n)=>{n?r(n):e(s)}):e()})},clearValidateState(t){const e=this.vm.$refs[t.wrapRef];e&&e.clearValidate()},tidyOptions(t){return["submitBtn","resetBtn","row","info","wrap","col","title"].forEach(e=>{oi(t,e)}),t},tidyRule({prop:t}){return Pt(t,"title"),Pt(t,"info"),t},mergeProp(t){const e={info:{trigger:"hover",placement:"top-start",icon:"el-icon-warning"},title:{},col:{span:24},wrap:{}};["info","wrap","col","title"].forEach(r=>{t.prop[r]=Q([this.options[r]||{},t.prop[r]||{}],e[r])})},getDefaultOptions(){return ni()},update(){const t=this.options.form;this.rule={props:_({},t),nativeOn:{submit:e=>{e.preventDefault()}},class:[t.className,t.class,"form-create",this.$handle.preview?"is-preview":""],style:t.style,type:"form"}},beforeRender(){const{key:t,ref:e,$handle:r}=this;C(this.rule,{key:t,ref:e}),C(this.rule.props,{model:r.formData})},render(t){return t.slotLen()&&!this.$handle.preview&&t.setSlot(void 0,()=>this.makeFormBtn()),this.$r(this.rule,Y(this.options.row.show)?t.getSlots():[this.makeRow(t)])},makeWrap(t,e){const r=t.prop,i=`${this.key}${t.key}`,s=r.col,n=this.isTitle(r)&&r.wrap.title!==!1,o=!s.labelWidth&&!n?0:s.labelWidth,{inline:a,col:l}=this.rule.props;delete r.wrap.title;const u=Y(r.wrap.show)?e:this.$r(Q([r.wrap,{props:G(_({labelWidth:o===void 0?o:lt(o),label:n?r.title.title:void 0},ze(r.wrap||{})),{prop:t.id,rules:t.injectValidate()}),class:this.$render.mergeClass(r.className,"fc-form-item"),key:`${i}fi`,ref:t.wrapRef,type:"formItem"}]),_({default:()=>e},n?{label:()=>this.makeInfo(r,i,t)}:{}));return a===!0||Y(l)||Y(s.show)?u:this.makeCol(r,i,[u])},isTitle(t){if(this.options.form.title===!1)return!1;const e=t.title;return!(!e.title&&!e.native||Y(e.show))},makeInfo(t,e,r){var c,d,y;const i=_({},t.title),s=_({},t.info),n=si(s),o=this.options.form,a=this.getSlot("title"),l=[a?a({title:(c=r.refRule)==null?void 0:c.__$title.value,rule:r.rule,options:this.options}):((d=r.refRule)==null?void 0:d.__$title.value)+(o.labelSuffix||o["label-suffix"]||"")];if(!Y(s.show)&&(s.info||s.native)&&!Y(s.icon)){const g={type:s.type||"popover",slot:"label",props:ze(s),key:`${e}pop`};delete g.props.icon,delete g.props.show,delete g.props.info,delete g.props.align,delete g.props.native;const b="content";s.info&&!F(g.props,b)&&(g.props[b]=(y=r.refRule)==null?void 0:y.__$info.value),l[s.align!=="left"?"unshift":"push"](this.$r(Q([s,g]),[this.$r({type:"i",slot:n?"default":"reference",class:s.icon===!0?"el-icon-warning":s.icon,key:`${e}i`})]))}const u=Q([i,{props:ze(i),key:`${e}tit`,class:"fc-form-title",slot:i.slot||"label",type:i.type||"span"}]);return delete u.props.show,delete u.props.title,delete u.props.native,this.$r(u,l)},makeCol(t,e,r){const i=t.col;return this.$r({class:this.$render.mergeClass(i.class,"fc-form-col"),type:"col",props:i||{span:24},key:`${e}col`},r)},makeRow(t){const e=this.options.row||{};return this.$r({type:"row",props:e,class:this.$render.mergeClass(e.class,"fc-form-row"),key:`${this.key}row`},t)},makeFormBtn(){let t=[];if(Y(this.options.submitBtn.show)||t.push(this.makeSubmitBtn()),Y(this.options.resetBtn.show)||t.push(this.makeResetBtn()),!t.length)return;const e=this.$r({type:"formItem",class:"fc-form-item",key:`${this.key}fb`},t);return this.rule.props.inline===!0?e:this.$r({type:"col",class:"fc-form-col fc-form-footer",props:{span:24},key:`${this.key}fc`},[e])},makeResetBtn(){const t=_({},this.options.resetBtn),e=t.innerText||this.$handle.api.t("reset")||"重置";return delete t.innerText,delete t.click,delete t.col,delete t.show,this.$r({type:"button",props:t,class:"fc-reset-btn",style:{width:t.width},on:{click:()=>{const r=this.$handle.api;this.options.resetBtn.click?this.options.resetBtn.click(r):r.resetFields()}},key:`${this.key}b2`},[e])},makeSubmitBtn(){const t=_({},this.options.submitBtn),e=t.innerText||this.$handle.api.t("submit")||"提交";return delete t.innerText,delete t.click,delete t.col,delete t.show,this.$r({type:"button",props:t,class:"fc-submit-btn",style:{width:t.width},on:{click:()=>{const r=this.$handle.api;this.options.submitBtn.click?this.options.submitBtn.click(r):r.submit().catch(()=>{})}},key:`${this.key}b1`},[e])}},ae={};li(ae),ui(ae),ci(ae),fi(ae),hi(ae);function li(t){["group","tree","switch","upload","autoComplete","checkbox","cascader","colorPicker","datePicker","frame","inputNumber","radio","rate"].forEach(e=>{t[e]=B(e)}),t.auto=t.autoComplete,t.number=t.inputNumber,t.color=t.colorPicker}function ui(t){const e="select",r="multiple";t.selectMultiple=B(e,{[r]:!0}),t.selectOne=B(e,{[r]:!1})}function ci(t){const e="tree",r={treeSelected:"selected",treeChecked:"checked"};Object.keys(r).reduce((i,s)=>(i[s]=B(e,{type:r[s]}),i),t)}function fi(t){const e="upload",r={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]};Object.keys(r).reduce((i,s)=>(i[s]=B(e,n=>n.props({uploadType:r[s][0],maxLength:r[s][1]})),i),t),t.uploadImage=t.image,t.uploadFile=t.file}function hi(t){const e={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]};return Object.keys(e).reduce((r,i)=>(r[i]=B("frame",s=>s.props({type:e[i][0],maxLength:e[i][1]})),r),t),t.frameInput=t.frameInputs,t.frameFile=t.frameFiles,t.frameImage=t.frameImages,t}function Tt(t,e){return h.Boolean(t)?t={show:t}:!h.Undef(t)&&!h.Object(t)&&(t={show:e}),t}function di(t,e){return{formEl(){return e.$manager.form()},wrapEl(r){const i=e.getFieldCtx(r);if(i)return e.vm.$refs[i.wrapRef]},validate(r){return new Promise((i,s)=>{const n=t.children,o=[e.$manager.validate()];n.forEach(a=>{o.push(a.validate())}),Promise.all(o).then(()=>{i(!0),r&&r(!0)}).catch(a=>{s(a),r&&r(a),e.vm.$emit("validate-fail",a,{api:t})})})},validateField(r,i){return new Promise((s,n)=>{const o=e.getFieldCtx(r);if(!o)return;const a=e.subForm[o.id],l=[e.$manager.validateField(o.id)];q(a).forEach(u=>{l.push(u.validate())}),Promise.all(l).then(()=>{s(null),i&&i(null)}).catch(u=>{n(u),i&&i(u),e.vm.$emit("validate-field-fail",u,{field:r,api:t})})})},clearValidateState(r,i=!0){t.helper.tidyFields(r).forEach(s=>{i&&this.clearSubValidateState(s),e.getCtxs(s).forEach(n=>{e.$manager.clearValidateState(n)})})},clearSubValidateState(r){t.helper.tidyFields(r).forEach(i=>{e.getCtxs(i).forEach(s=>{const n=e.subForm[s.id];n&&(Array.isArray(n)?n.forEach(o=>{o.clearValidateState()}):n&&n.clearValidateState())})})},btn:{loading:(r=!0)=>{t.submitBtnProps({loading:!!r})},disabled:(r=!0)=>{t.submitBtnProps({disabled:!!r})},show:(r=!0)=>{t.submitBtnProps({show:!!r})}},resetBtn:{loading:(r=!0)=>{t.resetBtnProps({loading:!!r})},disabled:(r=!0)=>{t.resetBtnProps({disabled:!!r})},show:(r=!0)=>{t.resetBtnProps({show:!!r})}},submitBtnProps:(r={})=>{let i=Tt(e.options.submitBtn,!0);C(i,r),e.options.submitBtn=i,t.refreshOptions()},resetBtnProps:(r={})=>{let i=Tt(e.options.resetBtn,!1);C(i,r),e.options.resetBtn=i,t.refreshOptions()},submit(r,i){return new Promise((s,n)=>{t.validate().then(()=>{let o=t.formData();h.Function(r)&&O(()=>r(o,t)),h.Function(e.options.onSubmit)&&O(()=>e.options.onSubmit(o,t)),e.vm.$emit("submit",o,t),s(o)}).catch((...o)=>{h.Function(i)&&O(()=>i(t,...o)),n(...o)})})}}}const Bt={name:"required",load(t,e,r){const i=pi(t.getValue());if(i.required===!1)t.clearProp(),r.clearValidateState([e.field]);else{const s=_({required:!0,validator(o,a,l){h.empty(a)?l(s.message):l()}},i),n=e.__fc__.refRule.__$title.value;if(!s.message)s.message=r.t("required",{title:n})||n+(r.getLocale()==="en"?" is required":"不能为空");else{const o=s.message.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);o&&(s.message=r.t(o[1],{title:n}))}t.getProp().validate=[s]}r.sync(e)},watch(...t){Bt.load(...t)}};function pi(t){return h.Boolean(t)?{required:t}:h.String(t)?{message:t}:h.Undef(t)?{required:!1}:h.Function(t)?{validator:t}:h.Object(t)?t:{}}function mi(t){t.componentAlias(ii),tr.forEach(e=>{t.component(e.name,e)}),t.register(Bt),ri.forEach(e=>{t.parser(e)}),Object.keys(ae).forEach(e=>{t.maker[e]=ae[e]})}function gi(){return Dt({ui:"element-ui",version:"2.7.3",manager:ai,extendApi:di,install:mi,attrs:{normal:["col","wrap"],array:["className"],key:["title","info"]}})}const we=gi();typeof window!="undefined"&&(window.formCreate=we,window.Vue&&we.install(window.Vue));const yi=we.maker;P.default=we,P.maker=yi,Object.defineProperties(P,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
